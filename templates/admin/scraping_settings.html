{% extends "admin/base.html" %}

{% block title %}إعدادات الكشط التلقائي{% endblock %}

{% block admin_content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12 d-flex justify-content-between align-items-center">
            <h2><i class="fas fa-cog me-2"></i>إعدادات الكشط التلقائي</h2>
            <a href="{{ url_for('admin_auto_scraping') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-right me-2"></i>العودة
            </a>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">إعدادات النظام</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">حالة النظام</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="scraping_enabled" 
                                               name="scraping_enabled" {{ 'checked' if settings.scraping_enabled else '' }}>
                                        <label class="form-check-label" for="scraping_enabled">
                                            تفعيل الكشط التلقائي
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        عند الإيقاف، سيتوقف النظام عن البحث عن فصول جديدة تلقائياً
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">فحص الجودة</label>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="quality_check_enabled" 
                                               name="quality_check_enabled" {{ 'checked' if settings.quality_check_enabled else '' }}>
                                        <label class="form-check-label" for="quality_check_enabled">
                                            تفعيل فحص جودة الفصول
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        فحص الفصول المكشوطة للتأكد من جودتها قبل النشر
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="max_concurrent_scrapes" class="form-label">العمليات المتزامنة</label>
                                    <select class="form-select" id="max_concurrent_scrapes" name="max_concurrent_scrapes">
                                        <option value="1" {{ 'selected' if settings.max_concurrent_scrapes == '1' else '' }}>عملية واحدة</option>
                                        <option value="2" {{ 'selected' if settings.max_concurrent_scrapes == '2' else '' }}>عمليتان</option>
                                        <option value="3" {{ 'selected' if settings.max_concurrent_scrapes == '3' else '' }}>3 عمليات</option>
                                        <option value="5" {{ 'selected' if settings.max_concurrent_scrapes == '5' else '' }}>5 عمليات</option>
                                        <option value="10" {{ 'selected' if settings.max_concurrent_scrapes == '10' else '' }}>10 عمليات</option>
                                    </select>
                                    <div class="form-text">
                                        عدد عمليات الكشط التي يمكن تشغيلها في نفس الوقت
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="scraping_delay" class="form-label">التأخير بين العمليات (ثانية)</label>
                                    <select class="form-select" id="scraping_delay" name="scraping_delay">
                                        <option value="1" {{ 'selected' if settings.scraping_delay == '1' else '' }}>ثانية واحدة</option>
                                        <option value="3" {{ 'selected' if settings.scraping_delay == '3' else '' }}>3 ثواني</option>
                                        <option value="5" {{ 'selected' if settings.scraping_delay == '5' else '' }}>5 ثواني</option>
                                        <option value="10" {{ 'selected' if settings.scraping_delay == '10' else '' }}>10 ثواني</option>
                                        <option value="30" {{ 'selected' if settings.scraping_delay == '30' else '' }}>30 ثانية</option>
                                    </select>
                                    <div class="form-text">
                                        مدة الانتظار بين كل عملية كشط للتخفيف على الخوادم
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <!-- System Information -->
                        <div class="row">
                            <div class="col-12">
                                <h6 class="mb-3">معلومات النظام</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card border-light bg-light">
                                            <div class="card-body p-3">
                                                <h6 class="card-title">حالة الجدولة</h6>
                                                <p class="card-text">
                                                    <span class="badge bg-success">نشط</span>
                                                    <small class="text-muted d-block">آخر فحص: منذ 5 دقائق</small>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card border-light bg-light">
                                            <div class="card-body p-3">
                                                <h6 class="card-title">المصادر النشطة</h6>
                                                <p class="card-text">
                                                    <span class="badge bg-info">{{ sources_count or 0 }}</span>
                                                    <small class="text-muted d-block">مصدر مراقب</small>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <!-- Advanced Settings -->
                        <div class="row">
                            <div class="col-12">
                                <h6 class="mb-3">إعدادات متقدمة</h6>
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>تحذير:</strong> تغيير هذه الإعدادات قد يؤثر على أداء النظام. 
                                    تأكد من فهم التأثير قبل التعديل.
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">إعدادات المراقبة</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="log_detailed" name="log_detailed">
                                                <label class="form-check-label" for="log_detailed">
                                                    سجل مفصل للعمليات
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="notify_admin" name="notify_admin" checked>
                                                <label class="form-check-label" for="notify_admin">
                                                    إشعار الإدارة بالأخطاء
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">إعدادات التنظيف</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="auto_cleanup" name="auto_cleanup" checked>
                                                <label class="form-check-label" for="auto_cleanup">
                                                    تنظيف السجلات القديمة تلقائياً
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="compress_logs" name="compress_logs">
                                                <label class="form-check-label" for="compress_logs">
                                                    ضغط السجلات القديمة
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('admin_auto_scraping') }}" class="btn btn-secondary me-md-2">إلغاء</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>حفظ الإعدادات
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- System Status -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">حالة النظام التفصيلية</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>إحصائيات اليوم</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-search text-primary me-2"></i>عمليات الفحص: <strong>24</strong></li>
                                <li><i class="fas fa-download text-success me-2"></i>فصول مكشوطة: <strong>8</strong></li>
                                <li><i class="fas fa-exclamation-triangle text-warning me-2"></i>أخطاء: <strong>2</strong></li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>إحصائيات الأسبوع</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-search text-primary me-2"></i>عمليات الفحص: <strong>168</strong></li>
                                <li><i class="fas fa-download text-success me-2"></i>فصول مكشوطة: <strong>42</strong></li>
                                <li><i class="fas fa-exclamation-triangle text-warning me-2"></i>أخطاء: <strong>5</strong></li>
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <h6>المصادر الأكثر نشاطاً</h6>
                            <ul class="list-unstyled">
                                <li><span class="badge bg-info me-2">MangaDx</span><strong>15</strong> فصل</li>
                                <li><span class="badge bg-info me-2">Manganelo</span><strong>12</strong> فصل</li>
                                <li><span class="badge bg-info me-2">Mangakakalot</span><strong>8</strong> فصل</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}