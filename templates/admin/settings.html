{% extends "admin/base.html" %}

{% block title %}Site Settings - إعدادات الموقع{% endblock %}

{% block extra_css %}
<style>
/* Admin Settings Dark Theme */
.settings-section {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow-md);
    backdrop-filter: blur(10px);
}

.settings-header {
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 15px;
    margin-bottom: 20px;
}

.settings-header h4 {
    color: var(--text-color);
    margin: 0;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    font-weight: 600;
    color: var(--text-color) !important;
    margin-bottom: 0.5rem;
}

.form-text {
    font-size: 0.875rem;
    color: var(--text-muted) !important;
    margin-top: 0.25rem;
}

.setting-item {
    border: 1px solid var(--border-color);
    background: var(--bg-tertiary);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    transition: var(--transition);
}

.setting-item:hover {
    border-color: var(--primary-color);
    background: var(--bg-secondary);
    transform: translateY(-1px);
}

.color-preview {
    display: inline-block;
    width: 30px;
    height: 30px;
    border-radius: 5px;
    border: 2px solid var(--border-color);
    vertical-align: middle;
    margin-left: 10px;
}

.system-stat {
    background: var(--gradient-primary);
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-md);
}

.system-stat h5 {
    margin: 0;
    font-size: 1.8rem;
    font-weight: bold;
}

.system-stat small {
    opacity: 0.9;
}

.danger-zone {
    border: 2px solid var(--danger-color);
    border-radius: 10px;
    padding: 20px;
    background: rgba(220, 53, 69, 0.1);
    margin-top: 30px;
}

.danger-zone h5 {
    color: var(--danger-color);
    margin-bottom: 15px;
}

.nav-pills .nav-link {
    border-radius: 25px;
    margin-right: 5px;
    margin-bottom: 5px;
    transition: var(--transition);
    background: var(--bg-secondary);
    color: var(--text-color);
    border: 1px solid var(--border-color);
}

.nav-pills .nav-link:hover {
    background: var(--bg-tertiary);
    color: var(--text-color);
}

.nav-pills .nav-link.active {
    background: var(--primary-color) !important;
    border: none;
    color: white !important;
}

.badge-stat {
    font-size: 0.9rem;
    padding: 8px 12px;
    border-radius: 20px;
}

/* Logo Preview Styles */
.logo-preview-container {
    border: 2px dashed var(--border-color);
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    background: var(--bg-tertiary);
    margin-top: 0.5rem;
}

.logo-preview {
    max-width: 150px;
    max-height: 50px;
    object-fit: contain;
    border-radius: 4px;
    border: 1px solid var(--border-color);
}

.logo-preview-placeholder {
    color: var(--text-muted);
}

.upload-progress {
    display: none;
    margin-top: 10px;
}

.upload-success {
    color: var(--success-color);
    margin-top: 10px;
    display: none;
}

.upload-error {
    color: var(--danger-color);
    margin-top: 10px;
    display: none;
}

/* Cloudinary Account Cards */
.account-card {
    position: relative;
    z-index: 1;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    box-shadow: var(--shadow-md);
    transition: var(--transition);
    height: 100%; /* Ensure consistent card heights */
}

/* Cloudinary settings section spacing fix */
#cloudinary .settings-section {
    margin-bottom: 0 !important;
}

#cloudinary .settings-header {
    margin-bottom: 1.5rem !important;
}

.account-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.account-card .card-header {
    background: var(--bg-tertiary);
    border-bottom: 1px solid var(--border-color);
    position: relative;
    z-index: 10;
}

.account-card .dropdown {
    position: relative;
    z-index: 1000;
}

.account-card .dropdown-menu {
    position: absolute !important;
    z-index: 1050 !important;
    top: 100% !important;
    right: 0 !important;
    left: auto !important;
    transform: none !important;
    background: var(--bg-secondary) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 8px !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
    min-width: 160px !important;
    margin-top: 5px !important;
}

.account-card .dropdown-menu.show {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
}

.account-card .dropdown-item {
    color: var(--text-color) !important;
    padding: 10px 15px !important;
    border-radius: 6px !important;
    margin: 3px !important;
    transition: all 0.2s ease !important;
}

.account-card .dropdown-item:hover {
    background: var(--bg-tertiary) !important;
    color: var(--text-color) !important;
    transform: translateX(3px);
}

.account-card .dropdown-item.text-danger {
    color: var(--danger-color) !important;
}

.account-card .dropdown-item.text-danger:hover {
    background: rgba(220, 53, 69, 0.1) !important;
    color: var(--danger-color) !important;
}

.account-card .dropdown-divider {
    border-top: 1px solid var(--border-color) !important;
    margin: 5px 0 !important;
}

/* Ensure dropdown appears above other elements */
.dropdown-menu {
    z-index: 1055 !important;
}

/* Override Bootstrap's default positioning */
.dropdown-menu[data-bs-popper] {
    right: 0 !important;
    left: auto !important;
}

@media (max-width: 768px) {
    .settings-section {
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .account-card .dropdown-menu {
        right: -10px !important;
        min-width: 140px !important;
    }
    
    .system-stat {
        padding: 15px;
    }
    
    .system-stat h5 {
        font-size: 1.4rem;
    }
    
    .logo-preview-container {
        margin-top: 15px;
    }
    
    .logo-preview {
        max-height: 80px;
        max-width: 200px;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        padding: 5px;
        background: white;
    }
    
    .logo-preview-placeholder {
        border: 2px dashed var(--border-color);
        border-radius: 5px;
        padding: 20px;
        text-align: center;
        background: var(--bg-tertiary);
    }
    
    .navbar-logo {
        max-height: 40px;
        width: auto;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">
                <i class="fas fa-cog me-2"></i>
                <span data-lang="en">Site Settings</span>
                <span data-lang="ar">إعدادات الموقع</span>
            </h2>
        </div>
    </div>

    <!-- Settings Navigation -->
    <div class="row mb-4">
        <div class="col-12">
            <ul class="nav nav-pills" id="settingsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="general-tab" data-bs-toggle="pill" data-bs-target="#general" type="button" role="tab">
                        <i class="fas fa-globe me-1"></i>
                        <span data-lang="en">General</span>
                        <span data-lang="ar">عام</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="appearance-tab" data-bs-toggle="pill" data-bs-target="#appearance" type="button" role="tab">
                        <i class="fas fa-palette me-1"></i>
                        <span data-lang="en">Appearance</span>
                        <span data-lang="ar">المظهر</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="reading-tab" data-bs-toggle="pill" data-bs-target="#reading" type="button" role="tab">
                        <i class="fas fa-book-reader me-1"></i>
                        <span data-lang="en">Reading</span>
                        <span data-lang="ar">القراءة</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="content-tab" data-bs-toggle="pill" data-bs-target="#content" type="button" role="tab">
                        <i class="fas fa-upload me-1"></i>
                        <span data-lang="en">Content</span>
                        <span data-lang="ar">المحتوى</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="security-tab" data-bs-toggle="pill" data-bs-target="#security" type="button" role="tab">
                        <i class="fas fa-shield-alt me-1"></i>
                        <span data-lang="en">Security</span>
                        <span data-lang="ar">الأمان</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="authentication-tab" data-bs-toggle="pill" data-bs-target="#authentication" type="button" role="tab">
                        <i class="fas fa-sign-in-alt me-1"></i>
                        <span data-lang="en">Authentication</span>
                        <span data-lang="ar">المصادقة</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="advanced-tab" data-bs-toggle="pill" data-bs-target="#advanced" type="button" role="tab">
                        <i class="fas fa-cogs me-1"></i>
                        <span data-lang="en">Advanced</span>
                        <span data-lang="ar">متقدم</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="bravo-mail-tab" data-bs-toggle="pill" data-bs-target="#bravo-mail" type="button" role="tab">
                        <i class="fas fa-envelope me-1"></i>
                        <span data-lang="en">Bravo Mail</span>
                        <span data-lang="ar">Bravo Mail</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="admin-account-tab" data-bs-toggle="pill" data-bs-target="#admin-account" type="button" role="tab">
                        <i class="fas fa-user-shield me-1"></i>
                        <span data-lang="en">Admin Account</span>
                        <span data-lang="ar">حساب المدير</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="footer-tab" data-bs-toggle="pill" data-bs-target="#footer" type="button" role="tab">
                        <i class="fas fa-window-minimize me-1"></i>
                        <span data-lang="en">Footer</span>
                        <span data-lang="ar">الفوتر</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="seo-tab" data-bs-toggle="pill" data-bs-target="#seo" type="button" role="tab">
                        <i class="fas fa-search-plus me-1"></i>
                        <span data-lang="en">SEO</span>
                        <span data-lang="ar">تحسين محركات البحث</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="homepage-tab" data-bs-toggle="pill" data-bs-target="#homepage" type="button" role="tab">
                        <i class="fas fa-home me-1"></i>
                        <span data-lang="en">Homepage</span>
                        <span data-lang="ar">الصفحة الرئيسية</span>
                    </button>
                </li>
                
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cloudinary-tab" data-bs-toggle="pill" data-bs-target="#cloudinary" type="button" role="tab">
                        <i class="fas fa-cloud me-1"></i>
                        <span data-lang="en">Cloudinary</span>
                        <span data-lang="ar">إعدادات Cloudinary</span>
                    </button>
                </li>

                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="system-tab" data-bs-toggle="pill" data-bs-target="#system" type="button" role="tab">
                        <i class="fas fa-server me-1"></i>
                        <span data-lang="en">System</span>
                        <span data-lang="ar">النظام</span>
                    </button>
                </li>

            </ul>
        </div>
    </div>

    <form method="POST" id="settingsForm">
        <input type="hidden" name="action" value="save_settings">
        
        <div class="tab-content" id="settingsTabsContent">
            <!-- General Settings -->
            <div class="tab-pane fade show active" id="general" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-globe me-2"></i>
                            <span data-lang="en">General Site Settings</span>
                            <span data-lang="ar">الإعدادات العامة للموقع</span>
                        </h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Site Name</span>
                                    <span data-lang="ar">اسم الموقع</span>
                                </label>
                                <input type="text" class="form-control" name="setting_site_name" 
                                       value="{{ settings.get('site_name', 'منصة المانجا') }}">
                                <div class="form-text">
                                    <span data-lang="en">Name displayed in header and title</span>
                                    <span data-lang="ar">الاسم المعروض في الرأس والعنوان</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Site Tagline</span>
                                    <span data-lang="ar">شعار الموقع</span>
                                </label>
                                <input type="text" class="form-control" name="setting_site_tagline" 
                                       value="{{ settings.get('site_tagline', 'منصة قراءة المانجا المفضلة لديك') }}">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Site Logo Section -->
                    <div class="settings-section">
                        <div class="settings-header">
                            <h5>
                                <i class="fas fa-image me-2"></i>
                                <span data-lang="en">Site Logo</span>
                                <span data-lang="ar">شعار الموقع</span>
                            </h5>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label class="form-label">
                                        <span data-lang="en">Upload Logo</span>
                                        <span data-lang="ar">رفع الشعار</span>
                                    </label>
                                    <input type="file" class="form-control" id="logo-upload" 
                                           accept="image/*" onchange="previewLogo(this)">
                                    <div class="form-text">
                                        <span data-lang="en">Upload a logo image (PNG, JPG, SVG). Recommended size: 150x50 pixels</span>
                                        <span data-lang="ar">ارفع صورة الشعار (PNG, JPG, SVG). الحجم المقترح: 150x50 بكسل</span>
                                    </div>
                                    
                                    <!-- Hidden field for logo URL -->
                                    <input type="hidden" name="setting_logo_url" id="logo-url-field" 
                                           value="{{ settings.get('logo_url', '') }}">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <span data-lang="en">Or Use URL</span>
                                        <span data-lang="ar">أو استخدم رابط</span>
                                    </label>
                                    <input type="url" class="form-control" id="logo-url-input" 
                                           placeholder="https://example.com/logo.png"
                                           value="{{ settings.get('logo_url', '') }}"
                                           onchange="updateLogoUrl(this.value)">
                                    <div class="form-text">
                                        <span data-lang="en">Direct URL to logo image</span>
                                        <span data-lang="ar">رابط مباشر لصورة الشعار</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">
                                        <span data-lang="en">Preview</span>
                                        <span data-lang="ar">معاينة</span>
                                    </label>
                                    <div class="logo-preview-container">
                                        {% if settings.get('logo_url') %}
                                            <img id="logo-preview" src="{{ settings.get('logo_url') }}" 
                                                 alt="Site Logo" class="logo-preview">
                                        {% else %}
                                            <div id="logo-preview" class="logo-preview-placeholder">
                                                <i class="fas fa-image fa-2x text-muted"></i>
                                                <p class="text-muted mt-2">
                                                    <span data-lang="en">No logo uploaded</span>
                                                    <span data-lang="ar">لم يتم رفع شعار</span>
                                                </p>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span data-lang="en">Site Description</span>
                            <span data-lang="ar">وصف الموقع</span>
                        </label>
                        <textarea class="form-control" name="setting_site_description" rows="3">{{ settings.get('site_description', 'اقرأ المانجا والمانهوا المفضلة لديك عبر الإنترنت مجاناً') }}</textarea>
                        <div class="form-text">
                            <span data-lang="en">Meta description for SEO</span>
                            <span data-lang="ar">وصف تعريفي للموقع لمحركات البحث</span>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Admin Email</span>
                                    <span data-lang="ar">بريد المدير</span>
                                </label>
                                <input type="email" class="form-control" name="setting_admin_email" 
                                       value="{{ settings.get('admin_email', 'admin@mangaplatform.com') }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Contact Email</span>
                                    <span data-lang="ar">بريد التواصل</span>
                                </label>
                                <input type="email" class="form-control" name="setting_contact_email" 
                                       value="{{ settings.get('contact_email', 'contact@mangaplatform.com') }}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Default Language</span>
                                    <span data-lang="ar">اللغة الافتراضية</span>
                                </label>
                                <select class="form-select" name="setting_default_language">
                                    <option value="ar" {{ 'selected' if settings.get('default_language') == 'ar' else '' }}>العربية</option>
                                    <option value="en" {{ 'selected' if settings.get('default_language') == 'en' else '' }}>English</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Timezone</span>
                                    <span data-lang="ar">المنطقة الزمنية</span>
                                </label>
                                <select class="form-select" name="setting_timezone">
                                    <option value="Asia/Riyadh" {{ 'selected' if settings.get('timezone') == 'Asia/Riyadh' else '' }}>Asia/Riyadh</option>
                                    <option value="UTC" {{ 'selected' if settings.get('timezone') == 'UTC' else '' }}>UTC</option>
                                    <option value="Asia/Dubai" {{ 'selected' if settings.get('timezone') == 'Asia/Dubai' else '' }}>Asia/Dubai</option>
                                    <option value="Asia/Kuwait" {{ 'selected' if settings.get('timezone') == 'Asia/Kuwait' else '' }}>Asia/Kuwait</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_site_enabled" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_site_enabled" 
                                       value="true" {{ 'checked' if settings.get('site_enabled', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Site Enabled</span>
                                    <span data-lang="ar">تفعيل الموقع</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_maintenance_mode" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_maintenance_mode" 
                                       value="true" {{ 'checked' if settings.get('maintenance_mode', False) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Maintenance Mode</span>
                                    <span data-lang="ar">وضع الصيانة</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span data-lang="en">Maintenance Message</span>
                            <span data-lang="ar">رسالة الصيانة</span>
                        </label>
                        <textarea class="form-control" name="setting_maintenance_message" rows="2">{{ settings.get('maintenance_message', 'الموقع تحت الصيانة. سنعود قريباً!') }}</textarea>
                    </div>
                </div>
            </div>

            <!-- Appearance Settings -->
            <div class="tab-pane fade" id="appearance" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-palette me-2"></i>
                            <span data-lang="en">Appearance & Theme</span>
                            <span data-lang="ar">المظهر والثيم</span>
                        </h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Primary Color</span>
                                    <span data-lang="ar">اللون الأساسي</span>
                                </label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" name="setting_theme_color" 
                                           value="{{ settings.get('theme_color', '#007bff') }}" 
                                           onchange="updateColorPreview(this, 'theme-preview')">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.get('theme_color', '#007bff') }}" readonly>
                                </div>
                                <span id="theme-preview" class="color-preview" 
                                      style="background-color: {{ settings.get('theme_color', '#007bff') }}"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Secondary Color</span>
                                    <span data-lang="ar">اللون الثانوي</span>
                                </label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" name="setting_secondary_color" 
                                           value="{{ settings.get('secondary_color', '#6c757d') }}"
                                           onchange="updateColorPreview(this, 'secondary-preview')">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.get('secondary_color', '#6c757d') }}" readonly>
                                </div>
                                <span id="secondary-preview" class="color-preview" 
                                      style="background-color: {{ settings.get('secondary_color', '#6c757d') }}"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Logo URL</span>
                                    <span data-lang="ar">رابط الشعار</span>
                                </label>
                                <input type="url" class="form-control" name="setting_logo_url" 
                                       value="{{ settings.get('logo_url', '') if settings.get('logo_url') != 'None' else '' }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Favicon URL</span>
                                    <span data-lang="ar">رابط الأيقونة</span>
                                </label>
                                <input type="url" class="form-control" name="setting_favicon_url" 
                                       value="{{ settings.get('favicon_url', '') if settings.get('favicon_url') != 'None' else '' }}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span data-lang="en">Hero Background Image</span>
                            <span data-lang="ar">صورة خلفية القسم الرئيسي</span>
                        </label>
                        <input type="url" class="form-control" name="setting_hero_background" 
                               value="{{ settings.get('hero_background', '') if settings.get('hero_background') != 'None' else '' }}">
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Items Per Page</span>
                                    <span data-lang="ar">عدد العناصر في الصفحة</span>
                                </label>
                                <input type="number" class="form-control" name="setting_items_per_page" 
                                       value="{{ settings.get('items_per_page', 20) }}" min="5" max="100">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check form-switch mt-4">
                                <input type="hidden" name="setting_show_view_counts" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_show_view_counts" 
                                       value="true" {{ 'checked' if settings.get('show_view_counts', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Show View Counts</span>
                                    <span data-lang="ar">عرض عدد المشاهدات</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-check form-switch mt-4">
                                <input type="hidden" name="setting_show_ratings" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_show_ratings" 
                                       value="true" {{ 'checked' if settings.get('show_ratings', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Show Ratings</span>
                                    <span data-lang="ar">عرض التقييمات</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-check form-switch">
                        <input type="hidden" name="setting_enable_dark_mode" value="false">
                        <input class="form-check-input" type="checkbox" name="setting_enable_dark_mode" 
                               value="true" {{ 'checked' if settings.get('enable_dark_mode', True) else '' }}>
                        <label class="form-check-label">
                            <span data-lang="en">Enable Dark Mode Toggle</span>
                            <span data-lang="ar">تفعيل تبديل الوضع المظلم</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Reading Settings -->
            <div class="tab-pane fade" id="reading" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-book-reader me-2"></i>
                            <span data-lang="en">Reading Experience</span>
                            <span data-lang="ar">تجربة القراءة</span>
                        </h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Default Reading Mode</span>
                                    <span data-lang="ar">وضع القراءة الافتراضي</span>
                                </label>
                                <select class="form-select" name="setting_default_reading_mode">
                                    <option value="vertical" {{ 'selected' if settings.get('default_reading_mode') == 'vertical' else '' }}>
                                        <span data-lang="en">Vertical</span>
                                        <span data-lang="ar">عمودي</span>
                                    </option>
                                    <option value="horizontal" {{ 'selected' if settings.get('default_reading_mode') == 'horizontal' else '' }}>
                                        <span data-lang="en">Horizontal</span>
                                        <span data-lang="ar">أفقي</span>
                                    </option>
                                    <option value="webtoon" {{ 'selected' if settings.get('default_reading_mode') == 'webtoon' else '' }}>
                                        <span data-lang="en">Webtoon</span>
                                        <span data-lang="ar">ويبتون</span>
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Image Quality</span>
                                    <span data-lang="ar">جودة الصور</span>
                                </label>
                                <select class="form-select" name="setting_image_quality">
                                    <option value="low" {{ 'selected' if settings.get('image_quality') == 'low' else '' }}>
                                        <span data-lang="en">Low</span>
                                        <span data-lang="ar">منخفضة</span>
                                    </option>
                                    <option value="medium" {{ 'selected' if settings.get('image_quality') == 'medium' else '' }}>
                                        <span data-lang="en">Medium</span>
                                        <span data-lang="ar">متوسطة</span>
                                    </option>
                                    <option value="high" {{ 'selected' if settings.get('image_quality') == 'high' else '' }}>
                                        <span data-lang="en">High</span>
                                        <span data-lang="ar">عالية</span>
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Auto Scroll Speed</span>
                                    <span data-lang="ar">سرعة التمرير التلقائي</span>
                                </label>
                                <input type="range" class="form-range" name="setting_auto_scroll_speed" 
                                       min="1" max="5" value="{{ settings.get('auto_scroll_speed', 2) }}"
                                       oninput="updateRangeValue(this, 'scroll-speed-value')">
                                <div class="text-center">
                                    <span id="scroll-speed-value">{{ settings.get('auto_scroll_speed', 2) }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mt-4">
                                <div class="form-check form-switch mb-2">
                                    <input type="hidden" name="setting_allow_preloading" value="false">
                                    <input class="form-check-input" type="checkbox" name="setting_allow_preloading" 
                                           value="true" {{ 'checked' if settings.get('allow_preloading', True) else '' }}>
                                    <label class="form-check-label">
                                        <span data-lang="en">Allow Image Preloading</span>
                                        <span data-lang="ar">السماح بتحميل الصور مسبقاً</span>
                                    </label>
                                </div>
                                
                                <div class="form-check form-switch mb-2">
                                    <input type="hidden" name="setting_allow_fullscreen" value="false">
                                    <input class="form-check-input" type="checkbox" name="setting_allow_fullscreen" 
                                           value="true" {{ 'checked' if settings.get('allow_fullscreen', True) else '' }}>
                                    <label class="form-check-label">
                                        <span data-lang="en">Allow Fullscreen</span>
                                        <span data-lang="ar">السماح بملء الشاشة</span>
                                    </label>
                                </div>
                                
                                <div class="form-check form-switch">
                                    <input type="hidden" name="setting_enable_keyboard_shortcuts" value="false">
                                    <input class="form-check-input" type="checkbox" name="setting_enable_keyboard_shortcuts" 
                                           value="true" {{ 'checked' if settings.get('enable_keyboard_shortcuts', True) else '' }}>
                                    <label class="form-check-label">
                                        <span data-lang="en">Keyboard Shortcuts</span>
                                        <span data-lang="ar">اختصارات لوحة المفاتيح</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Webtoon Settings -->
                    <div class="mt-4 pt-4" style="border-top: 1px solid #dee2e6;">
                        <h5>
                            <span data-lang="en">Webtoon Settings</span>
                            <span data-lang="ar">إعدادات الويبتون</span>
                        </h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch mb-3">
                                    <input type="hidden" name="setting_enable_webtoon_mode" value="false">
                                    <input class="form-check-input" type="checkbox" name="setting_enable_webtoon_mode" 
                                           value="true" {{ 'checked' if settings.get('enable_webtoon_mode', True) else '' }}>
                                    <label class="form-check-label">
                                        <span data-lang="en">Enable Webtoon Mode</span>
                                        <span data-lang="ar">تفعيل وضع الويبتون</span>
                                    </label>
                                </div>
                                
                                <div class="form-check form-switch">
                                    <input type="hidden" name="setting_webtoon_auto_height" value="false">
                                    <input class="form-check-input" type="checkbox" name="setting_webtoon_auto_height" 
                                           value="true" {{ 'checked' if settings.get('webtoon_auto_height', True) else '' }}>
                                    <label class="form-check-label">
                                        <span data-lang="en">Auto Height Adjustment</span>
                                        <span data-lang="ar">ضبط الارتفاع تلقائياً</span>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <span data-lang="en">Gap Size (px)</span>
                                        <span data-lang="ar">حجم الفجوة (بكسل)</span>
                                    </label>
                                    <input type="number" class="form-control" name="setting_webtoon_gap_size" 
                                           value="{{ settings.get('webtoon_gap_size', 5) }}" min="0" max="20">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <span data-lang="en">Max Width (%)</span>
                                        <span data-lang="ar">العرض الأقصى (%)</span>
                                    </label>
                                    <input type="number" class="form-control" name="setting_webtoon_max_width" 
                                           value="{{ settings.get('webtoon_max_width', 100) }}" min="50" max="100">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Settings -->
            <div class="tab-pane fade" id="content" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-upload me-2"></i>
                            <span data-lang="en">Content Management</span>
                            <span data-lang="ar">إدارة المحتوى</span>
                        </h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_allow_user_uploads" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_allow_user_uploads" 
                                       value="true" {{ 'checked' if settings.get('allow_user_uploads', False) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Allow User Uploads</span>
                                    <span data-lang="ar">السماح برفع المستخدمين</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_require_chapter_approval" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_require_chapter_approval" 
                                       value="true" {{ 'checked' if settings.get('require_chapter_approval', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Require Chapter Approval</span>
                                    <span data-lang="ar">طلب موافقة على الفصول</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_auto_optimize_images" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_auto_optimize_images" 
                                       value="true" {{ 'checked' if settings.get('auto_optimize_images', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Auto Optimize Images</span>
                                    <span data-lang="ar">تحسين الصور تلقائياً</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_watermark_images" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_watermark_images" 
                                       value="true" {{ 'checked' if settings.get('watermark_images', False) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Add Watermark</span>
                                    <span data-lang="ar">إضافة علامة مائية</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Max Upload Size (MB)</span>
                                    <span data-lang="ar">الحد الأقصى للرفع (ميجابايت)</span>
                                </label>
                                <input type="number" class="form-control" name="setting_max_upload_size" 
                                       value="{{ settings.get('max_upload_size', 100) }}" min="1" max="1000">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Allowed Formats</span>
                                    <span data-lang="ar">التنسيقات المسموحة</span>
                                </label>
                                <input type="text" class="form-control" name="setting_allowed_image_formats" 
                                       value="{{ settings.get('allowed_image_formats', 'jpg,jpeg,png,webp') }}">
                                <div class="form-text">
                                    <span data-lang="en">Comma separated (jpg,png,webp)</span>
                                    <span data-lang="ar">مفصولة بفواصل (jpg,png,webp)</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Watermark Text</span>
                                    <span data-lang="ar">نص العلامة المائية</span>
                                </label>
                                <input type="text" class="form-control" name="setting_watermark_text" 
                                       value="{{ settings.get('watermark_text', 'Manga Platform') }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Settings -->
            <div class="tab-pane fade" id="security" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-shield-alt me-2"></i>
                            <span data-lang="en">Security & Authentication</span>
                            <span data-lang="ar">الأمان والمصادقة</span>
                        </h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_enable_rate_limiting" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_enable_rate_limiting" 
                                       value="true" {{ 'checked' if settings.get('enable_rate_limiting', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Enable Rate Limiting</span>
                                    <span data-lang="ar">تفعيل تحديد المعدل</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_require_email_verification" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_require_email_verification" 
                                       value="true" {{ 'checked' if settings.get('require_email_verification', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Email Verification</span>
                                    <span data-lang="ar">تأكيد البريد الإلكتروني</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_enable_2fa" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_enable_2fa" 
                                       value="true" {{ 'checked' if settings.get('enable_2fa', False) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Two-Factor Authentication</span>
                                    <span data-lang="ar">المصادقة الثنائية</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Max Login Attempts</span>
                                    <span data-lang="ar">محاولات تسجيل الدخول</span>
                                </label>
                                <input type="number" class="form-control" name="setting_max_login_attempts" 
                                       value="{{ settings.get('max_login_attempts', 5) }}" min="3" max="10">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Session Timeout (seconds)</span>
                                    <span data-lang="ar">انتهاء الجلسة (ثواني)</span>
                                </label>
                                <input type="number" class="form-control" name="setting_session_timeout" 
                                       value="{{ settings.get('session_timeout', 7200) }}" min="600" max="86400">
                                <div class="form-text">
                                    <span data-lang="en">Current: {{ (settings.get('session_timeout', 7200) / 3600)|round(1) }} hours</span>
                                    <span data-lang="ar">الحالي: {{ (settings.get('session_timeout', 7200) / 3600)|round(1) }} ساعة</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Authentication Settings -->
            <div class="tab-pane fade" id="authentication" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-sign-in-alt me-2"></i>
                            <span data-lang="en">Authentication Settings</span>
                            <span data-lang="ar">إعدادات المصادقة</span>
                        </h4>
                    </div>

                    <!-- Google OAuth Settings -->
                    <div class="setting-item">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fab fa-google me-2"></i>
                                <span data-lang="en">Enable Google OAuth</span>
                                <span data-lang="ar">تفعيل مصادقة Google</span>
                            </label>
                            <select class="form-select" name="google_oauth_enabled" onchange="updateSetting('google_oauth_enabled', this.value)">
                                <option value="true" {% if get_setting('google_oauth_enabled', 'false') == 'true' %}selected{% endif %}>
                                    <span data-lang="en">Enabled</span>
                                    <span data-lang="ar">مفعل</span>
                                </option>
                                <option value="false" {% if get_setting('google_oauth_enabled', 'false') == 'false' %}selected{% endif %}>
                                    <span data-lang="en">Disabled</span>
                                    <span data-lang="ar">معطل</span>
                                </option>
                            </select>
                            <div class="form-text">
                                <span data-lang="en">Allow users to sign in with their Google accounts</span>
                                <span data-lang="ar">السماح للمستخدمين بتسجيل الدخول باستخدام حسابات Google</span>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-key me-2"></i>
                                <span data-lang="en">Google OAuth Client ID</span>
                                <span data-lang="ar">معرف عميل Google OAuth</span>
                            </label>
                            <input type="text" class="form-control" 
                                   value="{{ get_setting('google_oauth_client_id', '') }}" 
                                   onchange="updateSetting('google_oauth_client_id', this.value)"
                                   placeholder="Google OAuth Client ID">
                            <div class="form-text">
                                <span data-lang="en">Your Google OAuth Client ID from Google Cloud Console</span>
                                <span data-lang="ar">معرف عميل Google OAuth من وحدة تحكم Google Cloud</span>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-lock me-2"></i>
                                <span data-lang="en">Google OAuth Client Secret</span>
                                <span data-lang="ar">سر عميل Google OAuth</span>
                            </label>
                            <input type="password" class="form-control" 
                                   value="{{ get_setting('google_oauth_client_secret', '') }}" 
                                   onchange="updateSetting('google_oauth_client_secret', this.value)"
                                   placeholder="Google OAuth Client Secret">
                            <div class="form-text">
                                <span data-lang="en">Your Google OAuth Client Secret from Google Cloud Console</span>
                                <span data-lang="ar">سر عميل Google OAuth من وحدة تحكم Google Cloud</span>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user-plus me-2"></i>
                                <span data-lang="en">Auto-register Google Users</span>
                                <span data-lang="ar">تسجيل مستخدمي Google تلقائياً</span>
                            </label>
                            <select class="form-select" name="google_oauth_auto_register" onchange="updateSetting('google_oauth_auto_register', this.value)">
                                <option value="true" {% if get_setting('google_oauth_auto_register', 'true') == 'true' %}selected{% endif %}>
                                    <span data-lang="en">Yes, auto-register</span>
                                    <span data-lang="ar">نعم، تسجيل تلقائي</span>
                                </option>
                                <option value="false" {% if get_setting('google_oauth_auto_register', 'true') == 'false' %}selected{% endif %}>
                                    <span data-lang="en">No, require manual registration</span>
                                    <span data-lang="ar">لا، تتطلب تسجيل يدوي</span>
                                </option>
                            </select>
                            <div class="form-text">
                                <span data-lang="en">Automatically create accounts for new Google users</span>
                                <span data-lang="ar">إنشاء حسابات تلقائياً للمستخدمين الجدد من Google</span>
                            </div>
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-language me-2"></i>
                                <span data-lang="en">Default Language for Google Users</span>
                                <span data-lang="ar">اللغة الافتراضية لمستخدمي Google</span>
                            </label>
                            <select class="form-select" name="google_oauth_default_language" onchange="updateSetting('google_oauth_default_language', this.value)">
                                <option value="en" {% if get_setting('google_oauth_default_language', 'en') == 'en' %}selected{% endif %}>English</option>
                                <option value="ar" {% if get_setting('google_oauth_default_language', 'en') == 'ar' %}selected{% endif %}>العربية</option>
                            </select>
                            <div class="form-text">
                                <span data-lang="en">Default language preference for new Google OAuth users</span>
                                <span data-lang="ar">تفضيل اللغة الافتراضي للمستخدمين الجدد من Google OAuth</span>
                            </div>
                        </div>
                    </div>

                    <!-- Setup Instructions -->
                    <div class="alert alert-info">
                        <h6 class="alert-heading">
                            <i class="fas fa-info-circle me-2"></i>
                            <span data-lang="en">Google OAuth Setup Instructions</span>
                            <span data-lang="ar">تعليمات إعداد Google OAuth</span>
                        </h6>
                        <ol class="mb-0">
                            <li>
                                <span data-lang="en">Go to </span>
                                <span data-lang="ar">اذهب إلى </span>
                                <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a>
                            </li>
                            <li>
                                <span data-lang="en">Create a new OAuth 2.0 Client ID</span>
                                <span data-lang="ar">أنشئ معرف عميل OAuth 2.0 جديد</span>
                            </li>
                            <li>
                                <span data-lang="en">Add this redirect URI: </span>
                                <span data-lang="ar">أضف رابط إعادة التوجيه هذا: </span>
                                <code>{{ request.url_root }}auth/google/callback</code>
                            </li>
                            <li>
                                <span data-lang="en">Copy your Client ID and Client Secret to the fields above</span>
                                <span data-lang="ar">انسخ معرف العميل وسر العميل إلى الحقول أعلاه</span>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Advanced Settings -->
            <div class="tab-pane fade" id="advanced" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-cogs me-2"></i>
                            <span data-lang="en">Advanced Configuration</span>
                            <span data-lang="ar">التكوين المتقدم</span>
                        </h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_cache_enabled" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_cache_enabled" 
                                       value="true" {{ 'checked' if settings.get('cache_enabled', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Enable Caching</span>
                                    <span data-lang="ar">تفعيل التخزين المؤقت</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_enable_compression" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_enable_compression" 
                                       value="true" {{ 'checked' if settings.get('enable_compression', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Enable Compression</span>
                                    <span data-lang="ar">تفعيل الضغط</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="setting_analytics_enabled" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_analytics_enabled" 
                                       value="true" {{ 'checked' if settings.get('analytics_enabled', True) else '' }}>
                                <label class="form-check-label">
                                    <span data-lang="en">Enable Analytics</span>
                                    <span data-lang="ar">تفعيل التحليلات</span>
                                </label>
                            </div>
                            
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_debug_mode" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_debug_mode" 
                                       value="true" {{ 'checked' if settings.get('debug_mode', False) else '' }}>
                                <label class="form-check-label text-warning">
                                    <span data-lang="en">Debug Mode</span>
                                    <span data-lang="ar">وضع التصحيح</span>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Cache Duration (seconds)</span>
                                    <span data-lang="ar">مدة التخزين المؤقت (ثواني)</span>
                                </label>
                                <input type="number" class="form-control" name="setting_cache_duration" 
                                       value="{{ settings.get('cache_duration', 3600) }}" min="60" max="86400">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Backup Frequency</span>
                                    <span data-lang="ar">تكرار النسخ الاحتياطي</span>
                                </label>
                                <select class="form-select" name="setting_backup_frequency">
                                    <option value="daily" {{ 'selected' if settings.get('backup_frequency') == 'daily' else '' }}>
                                        <span data-lang="en">Daily</span>
                                        <span data-lang="ar">يومي</span>
                                    </option>
                                    <option value="weekly" {{ 'selected' if settings.get('backup_frequency') == 'weekly' else '' }}>
                                        <span data-lang="en">Weekly</span>
                                        <span data-lang="ar">أسبوعي</span>
                                    </option>
                                    <option value="monthly" {{ 'selected' if settings.get('backup_frequency') == 'monthly' else '' }}>
                                        <span data-lang="en">Monthly</span>
                                        <span data-lang="ar">شهري</span>
                                    </option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <span data-lang="en">Max Concurrent Users</span>
                                    <span data-lang="ar">المستخدمين المتزامنين</span>
                                </label>
                                <input type="number" class="form-control" name="setting_max_concurrent_users" 
                                       value="{{ settings.get('max_concurrent_users', 1000) }}" min="100" max="10000">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Account Settings -->
            <div class="tab-pane fade" id="admin-account" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-user-shield me-2"></i>
                            <span data-lang="en">Admin Account Settings</span>
                            <span data-lang="ar">إعدادات حساب المدير</span>
                        </h4>
                        <p class="text-muted mb-0">
                            <span data-lang="en">Update admin username and password for security</span>
                            <span data-lang="ar">تحديث اسم المستخدم وكلمة المرور للأمان</span>
                        </p>
                    </div>
                    
                    <form method="POST" action="{{ url_for('admin_update_credentials') }}" id="adminCredentialsForm" class="admin-credentials-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-user me-1"></i>
                                        <span data-lang="en">Current Username</span>
                                        <span data-lang="ar">اسم المستخدم الحالي</span>
                                    </label>
                                    <input type="text" class="form-control" value="{{ current_user.username }}" disabled>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-envelope me-1"></i>
                                        <span data-lang="en">Current Email</span>
                                        <span data-lang="ar">البريد الإلكتروني الحالي</span>
                                    </label>
                                    <input type="email" class="form-control" value="{{ current_user.email }}" disabled>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-user-edit me-1"></i>
                                        <span data-lang="en">New Username</span>
                                        <span data-lang="ar">اسم المستخدم الجديد</span>
                                    </label>
                                    <input type="text" class="form-control" name="new_username" 
                                           placeholder-en="Enter new username" placeholder-ar="أدخل اسم المستخدم الجديد"
                                           minlength="3" maxlength="50">
                                    <div class="form-text">
                                        <span data-lang="en">Leave empty to keep current username</span>
                                        <span data-lang="ar">اتركه فارغاً للاحتفاظ باسم المستخدم الحالي</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-envelope-open me-1"></i>
                                        <span data-lang="en">New Email</span>
                                        <span data-lang="ar">البريد الإلكتروني الجديد</span>
                                    </label>
                                    <input type="email" class="form-control" name="new_email"
                                           placeholder-en="Enter new email" placeholder-ar="أدخل البريد الإلكتروني الجديد">
                                    <div class="form-text">
                                        <span data-lang="en">Leave empty to keep current email</span>
                                        <span data-lang="ar">اتركه فارغاً للاحتفاظ بالبريد الحالي</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-key me-1"></i>
                                        <span data-lang="en">Current Password</span>
                                        <span data-lang="ar">كلمة المرور الحالية</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" name="current_password" required
                                               placeholder-en="Enter current password" placeholder-ar="أدخل كلمة المرور الحالية">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('current_password')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">
                                        <span data-lang="en">Required to confirm changes</span>
                                        <span data-lang="ar">مطلوب لتأكيد التغييرات</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-lock me-1"></i>
                                        <span data-lang="en">New Password</span>
                                        <span data-lang="ar">كلمة المرور الجديدة</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" name="new_password" id="new_password"
                                               placeholder-en="Enter new password" placeholder-ar="أدخل كلمة المرور الجديدة"
                                               minlength="8">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">
                                        <span data-lang="en">Leave empty to keep current password. Min 8 characters</span>
                                        <span data-lang="ar">اتركه فارغاً للاحتفاظ بكلمة المرور الحالية. 8 أحرف على الأقل</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-check-circle me-1"></i>
                                        <span data-lang="en">Confirm New Password</span>
                                        <span data-lang="ar">تأكيد كلمة المرور الجديدة</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" name="confirm_password" id="confirm_password"
                                               placeholder-en="Confirm new password" placeholder-ar="أكد كلمة المرور الجديدة">
                                        <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirm_password')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">
                                        <span data-lang="en">Must match new password</span>
                                        <span data-lang="ar">يجب أن تطابق كلمة المرور الجديدة</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>
                                    <span data-lang="en">Important:</span>
                                    <span data-lang="ar">مهم:</span>
                                </strong>
                                <span data-lang="en">Changing these credentials will require you to log in again with the new information.</span>
                                <span data-lang="ar">تغيير هذه المعلومات سيتطلب منك تسجيل الدخول مرة أخرى بالمعلومات الجديدة.</span>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i>
                                <span data-lang="en">Update Admin Credentials</span>
                                <span data-lang="ar">تحديث بيانات المدير</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Footer Tab -->
            <div class="tab-pane fade" id="footer" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-window-minimize me-2"></i>
                            <span data-lang="en">Footer Settings</span>
                            <span data-lang="ar">إعدادات الفوتر</span>
                        </h4>
                    </div>

                    <!-- Footer Display Settings -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="mb-3">
                                <i class="fas fa-eye me-2"></i>
                                <span data-lang="en">Display Settings</span>
                                <span data-lang="ar">إعدادات العرض</span>
                            </h5>
                            
                            <div class="setting-item">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="setting_footer_enabled" id="footer_enabled" value="true"
                                           {% if settings_dict.get('footer_enabled', {}).get('parsed_value') == 'true' or settings_dict.get('footer_enabled', {}).get('parsed_value') == True %}checked{% endif %}>
                                    <input type="hidden" name="setting_footer_enabled" value="false">
                                    <label class="form-check-label fw-bold" for="footer_enabled">
                                        <span data-lang="en">Enable Footer</span>
                                        <span data-lang="ar">تفعيل الفوتر</span>
                                    </label>
                                    <div class="form-text">
                                        <span data-lang="en">Show/hide the footer across the entire site</span>
                                        <span data-lang="ar">إظهار/إخفاء الفوتر في جميع أنحاء الموقع</span>
                                    </div>
                                </div>

                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="setting_footer_show_social_links" id="footer_show_social_links" value="true"
                                           {% if settings_dict.get('footer_show_social_links', {}).get('parsed_value') == 'true' or settings_dict.get('footer_show_social_links', {}).get('parsed_value') == True %}checked{% endif %}>
                                    <input type="hidden" name="setting_footer_show_social_links" value="false">
                                    <label class="form-check-label fw-bold" for="footer_show_social_links">
                                        <span data-lang="en">Show Social Media Links</span>
                                        <span data-lang="ar">عرض روابط وسائل التواصل</span>
                                    </label>
                                    <div class="form-text">
                                        <span data-lang="en">Display social media icons and links in footer</span>
                                        <span data-lang="ar">عرض أيقونات وروابط وسائل التواصل في الفوتر</span>
                                    </div>
                                </div>

                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="setting_footer_show_quick_links" id="footer_show_quick_links" value="true"
                                           {% if settings_dict.get('footer_show_quick_links', {}).get('parsed_value') == 'true' or settings_dict.get('footer_show_quick_links', {}).get('parsed_value') == True %}checked{% endif %}>
                                    <input type="hidden" name="setting_footer_show_quick_links" value="false">
                                    <label class="form-check-label fw-bold" for="footer_show_quick_links">
                                        <span data-lang="en">Show Quick Links</span>
                                        <span data-lang="ar">عرض الروابط السريعة</span>
                                    </label>
                                    <div class="form-text">
                                        <span data-lang="en">Display quick navigation links in footer</span>
                                        <span data-lang="ar">عرض روابط التنقل السريع في الفوتر</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Site Information in Footer -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <span data-lang="en">Site Information</span>
                                <span data-lang="ar">معلومات الموقع</span>
                            </h5>
                            
                            <div class="setting-item">
                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_site_name">
                                        <span data-lang="en">Site Name (English)</span>
                                        <span data-lang="ar">اسم الموقع (الإنجليزية)</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_footer_site_name" id="footer_site_name"
                                           value="{{ settings_dict.get('footer_site_name', {}).get('value', '') or 'Global Manga Platform' }}"
                                           placeholder="Global Manga Platform">
                                    <div class="form-text">
                                        <span data-lang="en">Site name displayed in footer English version</span>
                                        <span data-lang="ar">اسم الموقع المعروض في الفوتر النسخة الإنجليزية</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_site_name_ar">
                                        <span data-lang="en">Site Name (Arabic)</span>
                                        <span data-lang="ar">اسم الموقع (العربية)</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_footer_site_name_ar" id="footer_site_name_ar"
                                           value="{{ settings_dict.get('footer_site_name_ar', {}).get('value', '') or 'منصة المانجا العالمية' }}"
                                           placeholder="منصة المانجا العالمية">
                                    <div class="form-text">
                                        <span data-lang="en">Site name displayed in footer Arabic version</span>
                                        <span data-lang="ar">اسم الموقع المعروض في الفوتر النسخة العربية</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_site_description">
                                        <span data-lang="en">Site Description (English)</span>
                                        <span data-lang="ar">وصف الموقع (الإنجليزية)</span>
                                    </label>
                                    <textarea class="form-control" name="setting_footer_site_description" id="footer_site_description"
                                              rows="3" placeholder="Your ultimate destination for manga, manhwa, and manhua reading.">{{ settings_dict.get('footer_site_description', {}).get('value', '') or 'Your ultimate destination for manga, manhwa, and manhua reading.' }}</textarea>
                                    <div class="form-text">
                                        <span data-lang="en">Site description displayed in footer English version</span>
                                        <span data-lang="ar">وصف الموقع المعروض في الفوتر النسخة الإنجليزية</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_site_description_ar">
                                        <span data-lang="en">Site Description (Arabic)</span>
                                        <span data-lang="ar">وصف الموقع (العربية)</span>
                                    </label>
                                    <textarea class="form-control" name="setting_footer_site_description_ar" id="footer_site_description_ar"
                                              rows="3" placeholder="وجهتك المثلى لقراءة المانجا والمانهوا والمانهوا.">{{ settings_dict.get('footer_site_description_ar', {}).get('value', '') or 'وجهتك المثلى لقراءة المانجا والمانهوا والمانهوا.' }}</textarea>
                                    <div class="form-text">
                                        <span data-lang="en">Site description displayed in footer Arabic version</span>
                                        <span data-lang="ar">وصف الموقع المعروض في الفوتر النسخة العربية</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Copyright Text Settings -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="mb-3">
                                <i class="fas fa-copyright me-2"></i>
                                <span data-lang="en">Copyright Text</span>
                                <span data-lang="ar">نص حقوق الطبع والنشر</span>
                            </h5>
                            
                            <div class="setting-item">
                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_copyright_text">
                                        <span data-lang="en">Copyright Text (English)</span>
                                        <span data-lang="ar">نص حقوق الطبع والنشر (الإنجليزية)</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_footer_copyright_text" id="footer_copyright_text"
                                           value="{{ settings_dict.get('footer_copyright_text', {}).get('value', '') or '' }}"
                                           placeholder="© 2025 Manga Platform. All rights reserved.">
                                    <div class="form-text">
                                        <span data-lang="en">Copyright notice displayed in English version</span>
                                        <span data-lang="ar">إشعار حقوق الطبع والنشر المعروض في النسخة الإنجليزية</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_copyright_text_ar">
                                        <span data-lang="en">Copyright Text (Arabic)</span>
                                        <span data-lang="ar">نص حقوق الطبع والنشر (العربية)</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_footer_copyright_text_ar" id="footer_copyright_text_ar"
                                           value="{{ settings_dict.get('footer_copyright_text_ar', {}).get('value', '') or '' }}"
                                           placeholder="© 2025 منصة المانجا. جميع الحقوق محفوظة.">
                                    <div class="form-text">
                                        <span data-lang="en">Copyright notice displayed in Arabic version</span>
                                        <span data-lang="ar">إشعار حقوق الطبع والنشر المعروض في النسخة العربية</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Social Media Links -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="mb-3">
                                <i class="fas fa-share-alt me-2"></i>
                                <span data-lang="en">Social Media Links</span>
                                <span data-lang="ar">روابط وسائل التواصل الاجتماعي</span>
                            </h5>
                            
                            <div class="setting-item">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_facebook_url">
                                            <i class="fab fa-facebook text-primary me-1"></i>
                                            <span data-lang="en">Facebook URL</span>
                                            <span data-lang="ar">رابط الفيسبوك</span>
                                        </label>
                                        <input type="url" class="form-control" name="setting_footer_facebook_url" id="footer_facebook_url"
                                               value="{{ settings_dict.get('footer_facebook_url', {}).get('value', '') or '' }}"
                                               placeholder="https://facebook.com/yourpage">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_twitter_url">
                                            <i class="fab fa-twitter text-info me-1"></i>
                                            <span data-lang="en">Twitter URL</span>
                                            <span data-lang="ar">رابط تويتر</span>
                                        </label>
                                        <input type="url" class="form-control" name="setting_footer_twitter_url" id="footer_twitter_url"
                                               value="{{ settings_dict.get('footer_twitter_url', {}).get('value', '') or '' }}"
                                               placeholder="https://twitter.com/yourhandle">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_instagram_url">
                                            <i class="fab fa-instagram text-danger me-1"></i>
                                            <span data-lang="en">Instagram URL</span>
                                            <span data-lang="ar">رابط الانستجرام</span>
                                        </label>
                                        <input type="url" class="form-control" name="setting_footer_instagram_url" id="footer_instagram_url"
                                               value="{{ settings_dict.get('footer_instagram_url', {}).get('value', '') or '' }}"
                                               placeholder="https://instagram.com/yourhandle">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_youtube_url">
                                            <i class="fab fa-youtube text-danger me-1"></i>
                                            <span data-lang="en">YouTube URL</span>
                                            <span data-lang="ar">رابط اليوتيوب</span>
                                        </label>
                                        <input type="url" class="form-control" name="setting_footer_youtube_url" id="footer_youtube_url"
                                               value="{{ settings_dict.get('footer_youtube_url', {}).get('value', '') or '' }}"
                                               placeholder="https://youtube.com/yourchannel">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_discord_url">
                                            <i class="fab fa-discord text-primary me-1"></i>
                                            <span data-lang="en">Discord URL</span>
                                            <span data-lang="ar">رابط الديسكورد</span>
                                        </label>
                                        <input type="url" class="form-control" name="setting_footer_discord_url" id="footer_discord_url"
                                               value="{{ settings_dict.get('footer_discord_url', {}).get('value', '') or '' }}"
                                               placeholder="https://discord.gg/yourserver">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_telegram_url">
                                            <i class="fab fa-telegram text-info me-1"></i>
                                            <span data-lang="en">Telegram URL</span>
                                            <span data-lang="ar">رابط التليجرام</span>
                                        </label>
                                        <input type="url" class="form-control" name="setting_footer_telegram_url" id="footer_telegram_url"
                                               value="{{ settings_dict.get('footer_telegram_url', {}).get('value', '') or '' }}"
                                               placeholder="https://t.me/yourchannel">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page Links -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="mb-3">
                                <i class="fas fa-link me-2"></i>
                                <span data-lang="en">Page Links</span>
                                <span data-lang="ar">روابط الصفحات</span>
                            </h5>
                            
                            <div class="setting-item">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_about_page_url">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <span data-lang="en">About Page URL</span>
                                            <span data-lang="ar">رابط صفحة حول الموقع</span>
                                        </label>
                                        <input type="text" class="form-control" name="setting_footer_about_page_url" id="footer_about_page_url"
                                               value="{{ settings_dict.get('footer_about_page_url', {}).get('value', '/about') or '/about' }}">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_privacy_policy_url">
                                            <i class="fas fa-shield-alt me-1"></i>
                                            <span data-lang="en">Privacy Policy URL</span>
                                            <span data-lang="ar">رابط سياسة الخصوصية</span>
                                        </label>
                                        <input type="text" class="form-control" name="setting_footer_privacy_policy_url" id="footer_privacy_policy_url"
                                               value="{{ settings_dict.get('footer_privacy_policy_url', {}).get('value', '/privacy-policy') or '/privacy-policy' }}">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_terms_of_service_url">
                                            <i class="fas fa-file-contract me-1"></i>
                                            <span data-lang="en">Terms of Service URL</span>
                                            <span data-lang="ar">رابط شروط الخدمة</span>
                                        </label>
                                        <input type="text" class="form-control" name="setting_footer_terms_of_service_url" id="footer_terms_of_service_url"
                                               value="{{ settings_dict.get('footer_terms_of_service_url', {}).get('value', '/terms-of-service') or '/terms-of-service' }}">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_contact_page_url">
                                            <i class="fas fa-envelope me-1"></i>
                                            <span data-lang="en">Contact Page URL</span>
                                            <span data-lang="ar">رابط صفحة الاتصال</span>
                                        </label>
                                        <input type="text" class="form-control" name="setting_footer_contact_page_url" id="footer_contact_page_url"
                                               value="{{ settings_dict.get('footer_contact_page_url', {}).get('value', '/contact') or '/contact' }}">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_dmca_page_url">
                                            <i class="fas fa-copyright me-1"></i>
                                            <span data-lang="en">DMCA Page URL</span>
                                            <span data-lang="ar">رابط صفحة DMCA</span>
                                        </label>
                                        <input type="text" class="form-control" name="setting_footer_dmca_page_url" id="footer_dmca_page_url"
                                               value="{{ settings_dict.get('footer_dmca_page_url', {}).get('value', '/dmca') or '/dmca' }}">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label class="form-label" for="footer_help_page_url">
                                            <i class="fas fa-question-circle me-1"></i>
                                            <span data-lang="en">Help/FAQ Page URL</span>
                                            <span data-lang="ar">رابط صفحة المساعدة</span>
                                        </label>
                                        <input type="text" class="form-control" name="setting_footer_help_page_url" id="footer_help_page_url"
                                               value="{{ settings_dict.get('footer_help_page_url', {}).get('value', '/help') or '/help' }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Content -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h5 class="mb-3">
                                <i class="fas fa-code me-2"></i>
                                <span data-lang="en">Custom Content</span>
                                <span data-lang="ar">المحتوى المخصص</span>
                            </h5>
                            
                            <div class="setting-item">
                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_custom_content">
                                        <span data-lang="en">Custom HTML Content (English)</span>
                                        <span data-lang="ar">محتوى HTML مخصص (الإنجليزية)</span>
                                    </label>
                                    <textarea class="form-control" name="setting_footer_custom_content" id="footer_custom_content" rows="4"
                                              placeholder="<div>Custom HTML content here...</div>">{{ settings_dict.get('footer_custom_content', {}).get('value', '') or '' }}</textarea>
                                    <div class="form-text">
                                        <span data-lang="en">Custom HTML content to display in footer (English version)</span>
                                        <span data-lang="ar">محتوى HTML مخصص لعرضه في الفوتر (النسخة الإنجليزية)</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="footer_custom_content_ar">
                                        <span data-lang="en">Custom HTML Content (Arabic)</span>
                                        <span data-lang="ar">محتوى HTML مخصص (العربية)</span>
                                    </label>
                                    <textarea class="form-control" name="setting_footer_custom_content_ar" id="footer_custom_content_ar" rows="4"
                                              placeholder="<div>محتوى HTML مخصص هنا...</div>">{{ settings_dict.get('footer_custom_content_ar', {}).get('value', '') or '' }}</textarea>
                                    <div class="form-text">
                                        <span data-lang="en">Custom HTML content to display in footer (Arabic version)</span>
                                        <span data-lang="ar">محتوى HTML مخصص لعرضه في الفوتر (النسخة العربية)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEO Settings -->
            <div class="tab-pane fade" id="seo" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-search-plus me-2"></i>
                            <span data-lang="en">SEO & Search Engine Optimization</span>
                            <span data-lang="ar">تحسين محركات البحث</span>
                        </h4>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <span data-lang="en">For comprehensive SEO management, visit the dedicated</span>
                        <span data-lang="ar">لإدارة شاملة لمحركات البحث، قم بزيارة</span>
                        <strong><a href="{{ url_for('admin_seo_settings') }}" class="text-decoration-none">
                            <span data-lang="en">SEO Management Page</span>
                            <span data-lang="ar">صفحة إدارة SEO</span>
                        </a></strong>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="setting-item">
                                <h5>
                                    <i class="fas fa-tags me-1"></i>
                                    <span data-lang="en">Basic SEO Settings</span>
                                    <span data-lang="ar">الإعدادات الأساسية لمحركات البحث</span>
                                </h5>
                                
                                <div class="form-group mb-3">
                                    <label class="form-label" for="seo_site_title">
                                        <span data-lang="en">Site Title</span>
                                        <span data-lang="ar">عنوان الموقع</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_seo_site_title" id="seo_site_title"
                                           value="{{ settings_dict.get('seo_site_title', {}).get('value', 'منصة المانجا') }}"
                                           placeholder="منصة المانجا - Manga Platform">
                                    <div class="form-text">
                                        <span data-lang="en">Title displayed in search results and browser tabs</span>
                                        <span data-lang="ar">العنوان المعروض في نتائج البحث وعلامات التبويب</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="seo_meta_description">
                                        <span data-lang="en">Meta Description</span>
                                        <span data-lang="ar">الوصف التعريفي</span>
                                    </label>
                                    <textarea class="form-control" name="setting_seo_meta_description" id="seo_meta_description" rows="3"
                                              placeholder="أفضل منصة لقراءة المانجا والمانهوا باللغة العربية مجاناً">{{ settings_dict.get('seo_meta_description', {}).get('value', '') }}</textarea>
                                    <div class="form-text">
                                        <span data-lang="en">Description shown in search results (160 characters max)</span>
                                        <span data-lang="ar">الوصف المعروض في نتائج البحث (حد أقصى 160 حرف)</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="seo_meta_keywords">
                                        <span data-lang="en">Keywords</span>
                                        <span data-lang="ar">الكلمات المفتاحية</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_seo_meta_keywords" id="seo_meta_keywords"
                                           value="{{ settings_dict.get('seo_meta_keywords', {}).get('value', '') }}"
                                           placeholder="مانجا, مانهوا, قراءة مجانية, عربي">
                                    <div class="form-text">
                                        <span data-lang="en">Comma-separated keywords for search engines</span>
                                        <span data-lang="ar">الكلمات المفتاحية مفصولة بفواصل</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="setting-item">
                                <h5>
                                    <i class="fas fa-chart-line me-1"></i>
                                    <span data-lang="en">Analytics & Tracking</span>
                                    <span data-lang="ar">التحليلات والتتبع</span>
                                </h5>
                                
                                <div class="form-group mb-3">
                                    <label class="form-label" for="seo_google_analytics">
                                        <span data-lang="en">Google Analytics ID</span>
                                        <span data-lang="ar">معرف Google Analytics</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_seo_google_analytics" id="seo_google_analytics"
                                           value="{{ settings_dict.get('seo_google_analytics', {}).get('value', '') }}"
                                           placeholder="G-XXXXXXXXXX">
                                    <div class="form-text">
                                        <span data-lang="en">Google Analytics tracking ID (G-XXXXXXXXXX)</span>
                                        <span data-lang="ar">معرف تتبع Google Analytics (G-XXXXXXXXXX)</span>
                                    </div>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="seo_google_tag_manager">
                                        <span data-lang="en">Google Tag Manager ID</span>
                                        <span data-lang="ar">معرف Google Tag Manager</span>
                                    </label>
                                    <input type="text" class="form-control" name="setting_seo_google_tag_manager" id="seo_google_tag_manager"
                                           value="{{ settings_dict.get('seo_google_tag_manager', {}).get('value', '') }}"
                                           placeholder="GTM-XXXXXXX">
                                    <div class="form-text">
                                        <span data-lang="en">Google Tag Manager container ID (GTM-XXXXXXX)</span>
                                        <span data-lang="ar">معرف حاوية Google Tag Manager (GTM-XXXXXXX)</span>
                                    </div>
                                </div>

                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="setting_seo_sitemap_enabled" 
                                           id="seo_sitemap_enabled" value="true"
                                           {{ 'checked' if settings_dict.get('seo_sitemap_enabled', {}).get('parsed_value', True) else '' }}>
                                    <input type="hidden" name="setting_seo_sitemap_enabled" value="false">
                                    <label class="form-check-label" for="seo_sitemap_enabled">
                                        <span data-lang="en">Enable XML Sitemap</span>
                                        <span data-lang="ar">تفعيل خريطة الموقع XML</span>
                                    </label>
                                </div>

                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="setting_seo_schema_enabled" 
                                           id="seo_schema_enabled" value="true"
                                           {{ 'checked' if settings_dict.get('seo_schema_enabled', {}).get('parsed_value', True) else '' }}>
                                    <input type="hidden" name="setting_seo_schema_enabled" value="false">
                                    <label class="form-check-label" for="seo_schema_enabled">
                                        <span data-lang="en">Enable Schema.org Markup</span>
                                        <span data-lang="ar">تفعيل البيانات المنظمة Schema.org</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-success">
                        <i class="fas fa-external-link-alt me-2"></i>
                        <strong>
                            <span data-lang="en">Quick Actions:</span>
                            <span data-lang="ar">إجراءات سريعة:</span>
                        </strong>
                        <div class="mt-2">
                            <a href="{{ url_for('admin_seo_settings') }}" class="btn btn-sm btn-outline-success me-2">
                                <i class="fas fa-cogs me-1"></i>
                                <span data-lang="en">Full SEO Settings</span>
                                <span data-lang="ar">إعدادات SEO الكاملة</span>
                            </a>
                            <a href="/sitemap.xml" target="_blank" class="btn btn-sm btn-outline-info me-2">
                                <i class="fas fa-sitemap me-1"></i>
                                <span data-lang="en">View Sitemap</span>
                                <span data-lang="ar">عرض خريطة الموقع</span>
                            </a>
                            <a href="/robots.txt" target="_blank" class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-robot me-1"></i>
                                <span data-lang="en">View Robots.txt</span>
                                <span data-lang="ar">عرض ملف Robots.txt</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Info -->
            <div class="tab-pane fade" id="system" role="tabpanel">
                <div class="settings-section">
                    <div class="settings-header">
                        <h4>
                            <i class="fas fa-server me-2"></i>
                            <span data-lang="en">System Information</span>
                            <span data-lang="ar">معلومات النظام</span>
                        </h4>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="system-stat">
                                <h5>{{ system_info.python_version }}</h5>
                                <small>Python Version</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="system-stat">
                                <h5>{{ system_info.cpu_count }}</h5>
                                <small>CPU Cores</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="system-stat">
                                <h5>{{ system_info.memory_available }}GB</h5>
                                <small>Available RAM</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="system-stat">
                                <h5>{{ system_info.disk_free }}GB</h5>
                                <small>Free Disk Space</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <h5>
                                <span data-lang="en">Database Statistics</span>
                                <span data-lang="ar">إحصائيات قاعدة البيانات</span>
                            </h5>
                            <div class="list-group">
                                <div class="list-group-item d-flex justify-content-between">
                                    <span>
                                        <span data-lang="en">Total Users</span>
                                        <span data-lang="ar">إجمالي المستخدمين</span>
                                    </span>
                                    <span class="badge bg-primary badge-stat">{{ db_stats.total_users }}</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between">
                                    <span>
                                        <span data-lang="en">Total Manga</span>
                                        <span data-lang="ar">إجمالي المانجا</span>
                                    </span>
                                    <span class="badge bg-success badge-stat">{{ db_stats.total_manga }}</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between">
                                    <span>
                                        <span data-lang="en">Total Chapters</span>
                                        <span data-lang="ar">إجمالي الفصول</span>
                                    </span>
                                    <span class="badge bg-info badge-stat">{{ db_stats.total_chapters }}</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between">
                                    <span>
                                        <span data-lang="en">Publishers</span>
                                        <span data-lang="ar">الناشرون</span>
                                    </span>
                                    <span class="badge bg-warning badge-stat">{{ db_stats.publishers }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5>
                                <span data-lang="en">Quick Actions</span>
                                <span data-lang="ar">إجراءات سريعة</span>
                            </h5>
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-outline-primary" onclick="testEmailSettings()">
                                    <i class="fas fa-envelope me-1"></i>
                                    <span data-lang="en">Test Email Settings</span>
                                    <span data-lang="ar">اختبار إعدادات البريد</span>
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="clearCache()">
                                    <i class="fas fa-broom me-1"></i>
                                    <span data-lang="en">Clear Cache</span>
                                    <span data-lang="ar">مسح الذاكرة المؤقتة</span>
                                </button>
                                <button type="button" class="btn btn-outline-info" onclick="exportSettings()">
                                    <i class="fas fa-download me-1"></i>
                                    <span data-lang="en">Export Settings</span>
                                    <span data-lang="ar">تصدير الإعدادات</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
        <!-- Bravo Mail Tab -->
        <div class="tab-pane fade" id="bravo-mail" role="tabpanel">
            <div class="settings-section">
                <div class="settings-header">
                    <h4>
                        <i class="fas fa-envelope me-2"></i>
                        <span data-lang="en">Bravo Mail Settings</span>
                        <span data-lang="ar">إعدادات Bravo Mail</span>
                    </h4>
                    <p class="text-muted">
                        <span data-lang="en">Configure Bravo Mail service for sending emails, contact forms, user notifications, and password reset emails.</span>
                        <span data-lang="ar">تكوين خدمة Bravo Mail لإرسال الإيميلات ونماذج التواصل وإشعارات المستخدمين ورسائل إعادة تعيين كلمة المرور.</span>
                    </p>
                </div>

                <!-- Bravo Mail Enable/Disable -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_bravo_mail_enabled" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_bravo_mail_enabled" 
                                       id="bravo_mail_enabled" value="true"
                                       {{ 'checked' if settings_dict.get('bravo_mail_enabled', {}).get('parsed_value', False) else '' }}>
                                <label class="form-check-label" for="bravo_mail_enabled">
                                    <span data-lang="en">Enable Bravo Mail Service</span>
                                    <span data-lang="ar">تفعيل خدمة Bravo Mail</span>
                                </label>
                            </div>
                            <div class="form-text">
                                <span data-lang="en">Enable Bravo Mail for sending all site emails</span>
                                <span data-lang="ar">تفعيل Bravo Mail لإرسال جميع إيميلات الموقع</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Configuration -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-key me-1"></i>
                                <span data-lang="en">API Key</span>
                                <span data-lang="ar">مفتاح API</span>
                            </label>
                            <input type="password" class="form-control" name="setting_bravo_mail_api_key" 
                                   value="{{ settings_dict.get('bravo_mail_api_key', {}).get('value', '') }}"
                                   placeholder="Enter your Bravo Mail API key">
                            <div class="form-text">
                                <span data-lang="en">Your Bravo Mail API key for authentication</span>
                                <span data-lang="ar">مفتاح API لخدمة Bravo Mail للمصادقة</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-link me-1"></i>
                                <span data-lang="en">API URL</span>
                                <span data-lang="ar">رابط API</span>
                            </label>
                            <input type="url" class="form-control" name="setting_bravo_mail_api_url" 
                                   value="{{ settings_dict.get('bravo_mail_api_url', {}).get('value', 'https://api.bravo-mail.com/v1/') }}">
                            <div class="form-text">
                                <span data-lang="en">Bravo Mail API base URL</span>
                                <span data-lang="ar">الرابط الأساسي لـ API خدمة Bravo Mail</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sender Information -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user me-1"></i>
                                <span data-lang="en">Sender Name</span>
                                <span data-lang="ar">اسم المرسل</span>
                            </label>
                            <input type="text" class="form-control" name="setting_bravo_mail_sender_name" 
                                   value="{{ settings_dict.get('bravo_mail_sender_name', {}).get('value', 'منصة المانجا') }}">
                            <div class="form-text">
                                <span data-lang="en">Name that appears as sender in emails</span>
                                <span data-lang="ar">الاسم الذي يظهر كمرسل في الإيميلات</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-envelope me-1"></i>
                                <span data-lang="en">Sender Email</span>
                                <span data-lang="ar">بريد المرسل</span>
                            </label>
                            <input type="email" class="form-control" name="setting_bravo_mail_sender_email" 
                                   value="{{ settings_dict.get('bravo_mail_sender_email', {}).get('value', 'noreply@mangaplatform.com') }}">
                            <div class="form-text">
                                <span data-lang="en">Email address used as sender</span>
                                <span data-lang="ar">عنوان البريد المستخدم كمرسل</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reply-To Configuration -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-reply me-1"></i>
                                <span data-lang="en">Reply-To Email</span>
                                <span data-lang="ar">بريد الرد</span>
                            </label>
                            <input type="email" class="form-control" name="setting_bravo_mail_reply_to" 
                                   value="{{ settings_dict.get('bravo_mail_reply_to', {}).get('value', 'support@mangaplatform.com') }}">
                            <div class="form-text">
                                <span data-lang="en">Email address for replies</span>
                                <span data-lang="ar">عنوان البريد للردود</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-clock me-1"></i>
                                <span data-lang="en">API Timeout (seconds)</span>
                                <span data-lang="ar">مهلة انتظار API (ثواني)</span>
                            </label>
                            <input type="number" class="form-control" name="setting_bravo_mail_timeout" min="5" max="300"
                                   value="{{ settings_dict.get('bravo_mail_timeout', {}).get('value', '30') }}">
                            <div class="form-text">
                                <span data-lang="en">Request timeout for API calls</span>
                                <span data-lang="ar">مهلة انتظار لاستدعاءات API</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Retry Configuration -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-redo me-1"></i>
                                <span data-lang="en">Max Retries</span>
                                <span data-lang="ar">أقصى عدد محاولات</span>
                            </label>
                            <input type="number" class="form-control" name="setting_bravo_mail_max_retries" min="1" max="10"
                                   value="{{ settings_dict.get('bravo_mail_max_retries', {}).get('value', '3') }}">
                            <div class="form-text">
                                <span data-lang="en">Maximum retry attempts for failed emails</span>
                                <span data-lang="ar">أقصى عدد محاولات لإعادة إرسال الإيميلات الفاشلة</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Email Section -->
                <div class="alert alert-info">
                    <h5 class="alert-heading">
                        <i class="fas fa-test-tube me-2"></i>
                        <span data-lang="en">Test Email Configuration</span>
                        <span data-lang="ar">اختبار إعدادات البريد الإلكتروني</span>
                    </h5>
                    <p class="mb-3">
                        <span data-lang="en">Test your Bravo Mail configuration by sending a test email.</span>
                        <span data-lang="ar">اختبر إعدادات Bravo Mail عبر إرسال إيميل تجريبي.</span>
                    </p>
                    <div class="row">
                        <div class="col-md-8">
                            <input type="email" class="form-control" id="testEmailAddress" 
                                   placeholder="Enter email address to test"
                                   value="{{ current_user.email if current_user.is_authenticated }}">
                        </div>
                        <div class="col-md-4">
                            <button type="button" class="btn btn-info w-100" onclick="testBravoMailConnection()">
                                <i class="fas fa-paper-plane me-1"></i>
                                <span data-lang="en">Send Test Email</span>
                                <span data-lang="ar">إرسال إيميل تجريبي</span>
                            </button>
                        </div>
                    </div>
                    <div id="testEmailResult" class="mt-3" style="display: none;"></div>
                </div>

                <!-- Quick Actions -->
                <div class="alert alert-success">
                    <h5 class="alert-heading">
                        <i class="fas fa-bolt me-2"></i>
                        <span data-lang="en">Quick Actions</span>
                        <span data-lang="ar">إجراءات سريعة</span>
                    </h5>
                    <div class="d-flex flex-wrap gap-2">
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="testBravoMailConnection()">
                            <i class="fas fa-plug me-1"></i>
                            <span data-lang="en">Test Connection</span>
                            <span data-lang="ar">اختبار الاتصال</span>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-info" onclick="viewEmailTemplates()">
                            <i class="fas fa-eye me-1"></i>
                            <span data-lang="en">View Email Templates</span>
                            <span data-lang="ar">عرض قوالب الإيميل</span>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="checkEmailStatus()">
                            <i class="fas fa-chart-line me-1"></i>
                            <span data-lang="en">Check Email Status</span>
                            <span data-lang="ar">فحص حالة الإيميلات</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Homepage Content Tab -->
        <div class="tab-pane fade" id="homepage" role="tabpanel">
            <div class="settings-section">
                <div class="settings-header">
                    <h4>
                        <i class="fas fa-home me-2"></i>
                        <span data-lang="en">Homepage Content Customization</span>
                        <span data-lang="ar">تخصيص محتوى الصفحة الرئيسية</span>
                    </h4>
                    <p class="text-muted">
                        <span data-lang="en">Customize all text content displayed on your homepage hero section, including titles, descriptions, and call-to-action buttons.</span>
                        <span data-lang="ar">قم بتخصيص جميع النصوص المعروضة في القسم الرئيسي للصفحة الرئيسية، بما في ذلك العناوين والأوصاف وأزرار الدعوة للعمل.</span>
                    </p>
                </div>

                <!-- Hero Section Settings -->
                <div class="row">
                    <div class="col-12">
                        <h5 class="mb-3">
                            <i class="fas fa-star me-2"></i>
                            <span data-lang="en">Hero Section</span>
                            <span data-lang="ar">القسم الرئيسي</span>
                        </h5>
                    </div>
                </div>

                <!-- Main Titles -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-heading me-1"></i>
                                <span data-lang="en">Main Title (Arabic)</span>
                                <span data-lang="ar">العنوان الرئيسي (عربي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_hero_title_ar" 
                                   value="{{ settings.get('homepage_hero_title_ar', 'اكتشف اللامحدود من المانجا والمانهوا') }}" 
                                   placeholder="اكتشف اللامحدود من المانجا والمانهوا">
                            <div class="form-text">
                                <span data-lang="en">Main hero title displayed to Arabic users</span>
                                <span data-lang="ar">العنوان الرئيسي المعروض للمستخدمين العرب</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-heading me-1"></i>
                                <span data-lang="en">Main Title (English)</span>
                                <span data-lang="ar">العنوان الرئيسي (إنجليزي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_hero_title_en" 
                                   value="{{ settings.get('homepage_hero_title_en', 'Discover Unlimited Manga & Manhwa') }}" 
                                   placeholder="Discover Unlimited Manga & Manhwa">
                            <div class="form-text">
                                <span data-lang="en">Main hero title displayed to English users</span>
                                <span data-lang="ar">العنوان الرئيسي المعروض للمستخدمين الإنجليز</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Subtitles -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-tag me-1"></i>
                                <span data-lang="en">Subtitle/Badge (Arabic)</span>
                                <span data-lang="ar">العنوان الفرعي/الشارة (عربي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_hero_subtitle_ar" 
                                   value="{{ settings.get('homepage_hero_subtitle_ar', 'أكبر منصة للمانجا والمانهوا في العالم') }}" 
                                   placeholder="أكبر منصة للمانجا والمانهوا في العالم">
                            <div class="form-text">
                                <span data-lang="en">Badge text shown above the main title (Arabic)</span>
                                <span data-lang="ar">نص الشارة المعروض فوق العنوان الرئيسي (عربي)</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-tag me-1"></i>
                                <span data-lang="en">Subtitle/Badge (English)</span>
                                <span data-lang="ar">العنوان الفرعي/الشارة (إنجليزي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_hero_subtitle_en" 
                                   value="{{ settings.get('homepage_hero_subtitle_en', 'World\'s Largest Manga & Manhwa Platform') }}" 
                                   placeholder="World's Largest Manga & Manhwa Platform">
                            <div class="form-text">
                                <span data-lang="en">Badge text shown above the main title (English)</span>
                                <span data-lang="ar">نص الشارة المعروض فوق العنوان الرئيسي (إنجليزي)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Descriptions -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-align-left me-1"></i>
                                <span data-lang="en">Description (Arabic)</span>
                                <span data-lang="ar">الوصف (عربي)</span>
                            </label>
                            <textarea class="form-control" name="setting_homepage_hero_description_ar" rows="4" 
                                      placeholder="اقرأ آلاف المانجا والمانهوا والمانهوا عالية الجودة...">{{ settings.get('homepage_hero_description_ar', 'اقرأ آلاف المانجا والمانهوا والمانهوا عالية الجودة. تتبع تقدمك، احفظ المفضلة، واستمتع بتجربة مميزة خالية من الإعلانات.') }}</textarea>
                            <div class="form-text">
                                <span data-lang="en">Hero section description text for Arabic users</span>
                                <span data-lang="ar">نص وصف القسم الرئيسي للمستخدمين العرب</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-align-left me-1"></i>
                                <span data-lang="en">Description (English)</span>
                                <span data-lang="ar">الوصف (إنجليزي)</span>
                            </label>
                            <textarea class="form-control" name="setting_homepage_hero_description_en" rows="4" 
                                      placeholder="Read thousands of high-quality manga, manhwa, and manhua series...">{{ settings.get('homepage_hero_description_en', 'Read thousands of high-quality manga, manhwa, and manhua series. Track your progress, bookmark favorites, and enjoy an ad-free premium experience.') }}</textarea>
                            <div class="form-text">
                                <span data-lang="en">Hero section description text for English users</span>
                                <span data-lang="ar">نص وصف القسم الرئيسي للمستخدمين الإنجليز</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Call-to-Action Buttons -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6 class="mb-3">
                            <i class="fas fa-mouse-pointer me-2"></i>
                            <span data-lang="en">Call-to-Action Buttons</span>
                            <span data-lang="ar">أزرار الدعوة للعمل</span>
                        </h6>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-play me-1"></i>
                                <span data-lang="en">Primary Button (Arabic)</span>
                                <span data-lang="ar">الزر الرئيسي (عربي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_cta_primary_ar" 
                                   value="{{ settings.get('homepage_cta_primary_ar', 'ابدأ القراءة') }}" 
                                   placeholder="ابدأ القراءة">
                            <div class="form-text">
                                <span data-lang="en">Main action button text (Arabic)</span>
                                <span data-lang="ar">نص زر العمل الرئيسي (عربي)</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-play me-1"></i>
                                <span data-lang="en">Primary Button (English)</span>
                                <span data-lang="ar">الزر الرئيسي (إنجليزي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_cta_primary_en" 
                                   value="{{ settings.get('homepage_cta_primary_en', 'Start Reading') }}" 
                                   placeholder="Start Reading">
                            <div class="form-text">
                                <span data-lang="en">Main action button text (English)</span>
                                <span data-lang="ar">نص زر العمل الرئيسي (إنجليزي)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user-plus me-1"></i>
                                <span data-lang="en">Secondary Button (Arabic)</span>
                                <span data-lang="ar">الزر الثانوي (عربي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_cta_secondary_ar" 
                                   value="{{ settings.get('homepage_cta_secondary_ar', 'انضم مجاناً') }}" 
                                   placeholder="انضم مجاناً">
                            <div class="form-text">
                                <span data-lang="en">Secondary action button text (Arabic)</span>
                                <span data-lang="ar">نص زر العمل الثانوي (عربي)</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-user-plus me-1"></i>
                                <span data-lang="en">Secondary Button (English)</span>
                                <span data-lang="ar">الزر الثانوي (إنجليزي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_cta_secondary_en" 
                                   value="{{ settings.get('homepage_cta_secondary_en', 'Join Free') }}" 
                                   placeholder="Join Free">
                            <div class="form-text">
                                <span data-lang="en">Secondary action button text (English)</span>
                                <span data-lang="ar">نص زر العمل الثانوي (إنجليزي)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h6 class="mb-3">
                            <i class="fas fa-chart-bar me-2"></i>
                            <span data-lang="en">Statistics Display</span>
                            <span data-lang="ar">عرض الإحصائيات</span>
                        </h6>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-book me-1"></i>
                                <span data-lang="en">Manga Count</span>
                                <span data-lang="ar">عدد المانجا</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_manga_count" 
                                   value="{{ settings.get('homepage_stats_manga_count', '10K+') }}" 
                                   placeholder="10K+">
                            <div class="form-text">
                                <span data-lang="en">Number to display (e.g., 10K+, 25,000)</span>
                                <span data-lang="ar">الرقم المراد عرضه (مثل: 10K+، 25,000)</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <span data-lang="en">Manga Label (Arabic)</span>
                                <span data-lang="ar">تسمية المانجا (عربي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_manga_label_ar" 
                                   value="{{ settings.get('homepage_stats_manga_label_ar', 'سلسلة مانجا') }}" 
                                   placeholder="سلسلة مانجا">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <span data-lang="en">Manga Label (English)</span>
                                <span data-lang="ar">تسمية المانجا (إنجليزي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_manga_label_en" 
                                   value="{{ settings.get('homepage_stats_manga_label_en', 'Manga Series') }}" 
                                   placeholder="Manga Series">
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-users me-1"></i>
                                <span data-lang="en">Readers Count</span>
                                <span data-lang="ar">عدد القراء</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_readers_count" 
                                   value="{{ settings.get('homepage_stats_readers_count', '1M+') }}" 
                                   placeholder="1M+">
                            <div class="form-text">
                                <span data-lang="en">Monthly readers number (e.g., 1M+, 500K)</span>
                                <span data-lang="ar">عدد القراء الشهري (مثل: 1M+، 500K)</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <span data-lang="en">Readers Label (Arabic)</span>
                                <span data-lang="ar">تسمية القراء (عربي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_readers_label_ar" 
                                   value="{{ settings.get('homepage_stats_readers_label_ar', 'قارئ شهرياً') }}" 
                                   placeholder="قارئ شهرياً">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <span data-lang="en">Readers Label (English)</span>
                                <span data-lang="ar">تسمية القراء (إنجليزي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_readers_label_en" 
                                   value="{{ settings.get('homepage_stats_readers_label_en', 'Monthly Readers') }}" 
                                   placeholder="Monthly Readers">
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-globe me-1"></i>
                                <span data-lang="en">Languages Count</span>
                                <span data-lang="ar">عدد اللغات</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_languages_count" 
                                   value="{{ settings.get('homepage_stats_languages_count', '50+') }}" 
                                   placeholder="50+">
                            <div class="form-text">
                                <span data-lang="en">Number of supported languages</span>
                                <span data-lang="ar">عدد اللغات المدعومة</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <span data-lang="en">Languages Label (Arabic)</span>
                                <span data-lang="ar">تسمية اللغات (عربي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_languages_label_ar" 
                                   value="{{ settings.get('homepage_stats_languages_label_ar', 'لغة') }}" 
                                   placeholder="لغة">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">
                                <span data-lang="en">Languages Label (English)</span>
                                <span data-lang="ar">تسمية اللغات (إنجليزي)</span>
                            </label>
                            <input type="text" class="form-control" name="setting_homepage_stats_languages_label_en" 
                                   value="{{ settings.get('homepage_stats_languages_label_en', 'Languages') }}" 
                                   placeholder="Languages">
                        </div>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="alert alert-info">
                    <h5 class="alert-heading">
                        <i class="fas fa-eye me-2"></i>
                        <span data-lang="en">Preview</span>
                        <span data-lang="ar">معاينة</span>
                    </h5>
                    <p class="mb-0">
                        <span data-lang="en">After saving changes, visit your homepage to see the updated content. Changes are applied immediately after saving.</span>
                        <span data-lang="ar">بعد حفظ التغييرات، قم بزيارة الصفحة الرئيسية لرؤية المحتوى المحدث. يتم تطبيق التغييرات فوراً بعد الحفظ.</span>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Cloudinary Tab -->
        <div class="tab-pane fade" id="cloudinary" role="tabpanel">
            <div class="settings-section">
                <div class="settings-header">
                    <h4>
                        <i class="fas fa-cloud me-2"></i>
                        <span data-lang="en">Cloudinary Settings</span>
                        <span data-lang="ar">إعدادات Cloudinary</span>
                    </h4>
                    <p class="text-muted">
                        <span data-lang="en">Manage your Cloudinary accounts for image storage and delivery. The system automatically switches to the next account when storage limits are reached.</span>
                        <span data-lang="ar">إدارة حسابات Cloudinary لتخزين وتوصيل الصور. ينتقل النظام تلقائياً للحساب التالي عند الوصول لحد التخزين.</span>
                    </p>
                </div>
                
                <!-- Cloudinary General Settings -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_cloudinary_enabled" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_cloudinary_enabled" value="true" id="cloudinary_enabled"
                                       {{ 'checked' if settings.get('cloudinary_enabled', 'true') == 'true' else '' }}>
                                <label class="form-check-label" for="cloudinary_enabled">
                                    <span data-lang="en">Enable Cloudinary Integration</span>
                                    <span data-lang="ar">تفعيل تكامل Cloudinary</span>
                                </label>
                            </div>
                            <div class="form-text">
                                <span data-lang="en">Enable cloud storage for manga images</span>
                                <span data-lang="ar">تفعيل التخزين السحابي لصور المانجا</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input type="hidden" name="setting_cloudinary_auto_switch" value="false">
                                <input class="form-check-input" type="checkbox" name="setting_cloudinary_auto_switch" value="true" id="cloudinary_auto_switch"
                                       {{ 'checked' if settings.get('cloudinary_auto_switch', 'true') == 'true' else '' }}>
                                <label class="form-check-label" for="cloudinary_auto_switch">
                                    <span data-lang="en">Auto Switch Accounts</span>
                                    <span data-lang="ar">التبديل التلقائي للحسابات</span>
                                </label>
                            </div>
                            <div class="form-text">
                                <span data-lang="en">Automatically switch when storage limit is reached</span>
                                <span data-lang="ar">التبديل التلقائي عند الوصول لحد التخزين</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Account Management Section -->
                <div class="settings-section mb-4">
                    <div class="settings-header d-flex justify-content-between align-items-center mb-4">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>
                            <span data-lang="en">Account Management</span>
                            <span data-lang="ar">إدارة الحسابات</span>
                        </h5>
                        <div>
                            <button type="button" class="btn btn-info btn-sm me-2" onclick="refreshAllAccountsUsage()">
                                <i class="fas fa-sync-alt me-1"></i>
                                <span data-lang="en">Refresh All</span>
                                <span data-lang="ar">تحديث الكل</span>
                            </button>
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addAccountModal">
                                <i class="fas fa-plus me-1"></i>
                                <span data-lang="en">Add Account</span>
                                <span data-lang="ar">إضافة حساب</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Account Cards -->
                    <div class="row g-3" id="cloudinary-accounts">
                        {% if cloudinary_accounts %}
                            {% for account in cloudinary_accounts %}
                            <div class="col-xl-4 col-lg-6 col-md-6 mb-3">
                                <div class="card account-card {% if account.is_primary %}border-primary{% endif %}">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            {{ account.name }}
                                            {% if account.is_primary %}
                                                <span class="badge bg-primary ms-2">
                                                    <span data-lang="en">Primary</span>
                                                    <span data-lang="ar">أساسي</span>
                                                </span>
                                            {% endif %}
                                        </h6>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="fas fa-ellipsis-v"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li><a class="dropdown-item" href="#" onclick="testCloudinaryConnection({{ account.id }})">
                                                    <i class="fas fa-plug me-2"></i>
                                                    <span data-lang="en">Test Connection</span>
                                                    <span data-lang="ar">اختبار الاتصال</span>
                                                </a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-danger" href="#" onclick="deleteCloudinaryAccount({{ account.id }})">
                                                    <i class="fas fa-trash me-2"></i>
                                                    <span data-lang="en">Delete Account</span>
                                                    <span data-lang="ar">حذف الحساب</span>
                                                </a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <small class="text-muted">Cloud Name:</small><br>
                                            <code>{{ account.cloud_name }}</code>
                                        </div>
                                        
                                        <!-- Storage Usage -->
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted">
                                                    <span data-lang="en">Storage Usage</span>
                                                    <span data-lang="ar">استخدام التخزين</span>
                                                </small>
                                                <div>
                                                    <small class="fw-bold" id="usage-percentage-{{ account.id }}">{{ "%.1f"|format(account.storage_usage_percentage) }}%</small>
                                                    <button class="btn btn-sm btn-outline-info ms-2" onclick="updateAccountUsage({{ account.id }})" title="تحديث من Cloudinary">
                                                        <i class="fas fa-sync-alt"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar {% if account.storage_usage_percentage > 90 %}bg-danger{% elif account.storage_usage_percentage > 75 %}bg-warning{% else %}bg-success{% endif %}"
                                                     id="progress-bar-{{ account.id }}"
                                                     style="width: {{ account.storage_usage_percentage }}%"></div>
                                            </div>
                                            <div class="d-flex justify-content-between mt-1">
                                                <small class="text-muted" id="used-storage-{{ account.id }}">{{ "%.1f"|format(account.storage_used_mb) }} MB</small>
                                                <small class="text-muted" id="total-storage-{{ account.id }}">{{ "%.1f"|format(account.storage_limit_mb) }} MB</small>
                                            </div>
                                            
                                            <!-- Real-time usage info section -->
                                            <div class="mt-2 p-2 bg-light rounded" id="real-usage-info-{{ account.id }}" style="display: none;">
                                                <small class="text-muted">
                                                    <span data-lang="en">Real-time from Cloudinary:</span>
                                                    <span data-lang="ar">في الوقت الفعلي من Cloudinary:</span>
                                                </small>
                                                <div class="row mt-1">
                                                    <div class="col-6">
                                                        <small class="text-muted">
                                                            <span data-lang="en">Media Files:</span>
                                                            <span data-lang="ar">الملفات:</span>
                                                        </small>
                                                        <br><small class="fw-bold" id="media-count-{{ account.id }}">-</small>
                                                    </div>
                                                    <div class="col-6">
                                                        <small class="text-muted">
                                                            <span data-lang="en">Credits:</span>
                                                            <span data-lang="ar">الرصيد:</span>
                                                        </small>
                                                        <br><small class="fw-bold" id="credits-usage-{{ account.id }}">-</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Account Status and Actions -->
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="badge {% if account.storage_usage_percentage < 95 %}bg-success{% else %}bg-danger{% endif %}" id="status-badge-{{ account.id }}">
                                                {% if account.storage_usage_percentage < 95 %}
                                                    <span data-lang="en">Available</span>
                                                    <span data-lang="ar">متاح</span>
                                                {% else %}
                                                    <span data-lang="en">Full</span>
                                                    <span data-lang="ar">ممتلئ</span>
                                                {% endif %}
                                            </span>
                                            <small class="text-muted">
                                                <span data-lang="en">Plan:</span>
                                                <span data-lang="ar">الخطة:</span>
                                                {{ account.plan_type|title }}
                                            </small>
                                        </div>
                                        
                                        <!-- Switch Account Button -->
                                        {% if not account.is_primary %}
                                        <div class="d-grid">
                                            <button class="btn btn-outline-primary btn-sm" onclick="switchToAccount({{ account.id }})">
                                                <i class="fas fa-exchange-alt me-1"></i>
                                                <span data-lang="en">Make Primary</span>
                                                <span data-lang="ar">جعل أساسي</span>
                                            </button>
                                        </div>
                                        {% else %}
                                        <div class="d-grid">
                                            <button class="btn btn-primary btn-sm" disabled>
                                                <i class="fas fa-star me-1"></i>
                                                <span data-lang="en">Current Primary</span>
                                                <span data-lang="ar">الحساب الأساسي الحالي</span>
                                            </button>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12">
                                <div class="alert alert-info text-center py-4">
                                    <div class="mb-3">
                                        <i class="fas fa-cloud fa-3x text-muted opacity-50"></i>
                                    </div>
                                    <h5 class="alert-heading">
                                        <span data-lang="en">No Cloudinary Accounts</span>
                                        <span data-lang="ar">لا توجد حسابات Cloudinary</span>
                                    </h5>
                                    <p class="mb-3">
                                        <span data-lang="en">You haven't configured any Cloudinary accounts yet. Add your first account to start using cloud storage for your manga images.</span>
                                        <span data-lang="ar">لم تقم بتكوين أي حسابات Cloudinary حتى الآن. أضف حسابك الأول لبدء استخدام التخزين السحابي لصور المانجا.</span>
                                    </p>
                                    <button type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addAccountModal">
                                        <i class="fas fa-plus me-1"></i>
                                        <span data-lang="en">Add Your First Account</span>
                                        <span data-lang="ar">أضف حسابك الأول</span>
                                    </button>
                                    <hr class="my-4">
                                    <div class="row text-start">
                                        <div class="col-md-4">
                                            <h6>
                                                <i class="fas fa-rocket me-1 text-primary"></i>
                                                <span data-lang="en">Fast Delivery</span>
                                                <span data-lang="ar">توصيل سريع</span>
                                            </h6>
                                            <small class="text-muted">
                                                <span data-lang="en">Global CDN for faster image loading</span>
                                                <span data-lang="ar">شبكة توصيل عالمية لتحميل أسرع للصور</span>
                                            </small>
                                        </div>
                                        <div class="col-md-4">
                                            <h6>
                                                <i class="fas fa-magic me-1 text-success"></i>
                                                <span data-lang="en">Auto Optimization</span>
                                                <span data-lang="ar">تحسين تلقائي</span>
                                            </h6>
                                            <small class="text-muted">
                                                <span data-lang="en">Automatic image compression and format conversion</span>
                                                <span data-lang="ar">ضغط تلقائي وتحويل تنسيق للصور</span>
                                            </small>
                                        </div>
                                        <div class="col-md-4">
                                            <h6>
                                                <i class="fas fa-shield-alt me-1 text-warning"></i>
                                                <span data-lang="en">Reliable Storage</span>
                                                <span data-lang="ar">تخزين موثوق</span>
                                            </h6>
                                            <small class="text-muted">
                                                <span data-lang="en">99.9% uptime with automatic backups</span>
                                                <span data-lang="ar">99.9% وقت تشغيل مع نسخ احتياطية تلقائية</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- END Cloudinary Tab -->
        
        </div> <!-- End tab-content -->
        
        <!-- Save Button -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="d-flex justify-content-between">
                    <div>
                        <button type="submit" class="btn btn-primary btn-lg me-2" onclick="handleSaveSettings(event)">
                            <i class="fas fa-save me-1"></i>
                            <span data-lang="en">Save Settings</span>
                            <span data-lang="ar">حفظ الإعدادات</span>
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="resetForm()">
                            <i class="fas fa-undo me-1"></i>
                            <span data-lang="en">Reset</span>
                            <span data-lang="ar">إعادة تعيين</span>
                        </button>
                    </div>
                    <div>
                        <button type="button" class="btn btn-warning" onclick="showDangerZone()">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            <span data-lang="en">Advanced Options</span>
                            <span data-lang="ar">خيارات متقدمة</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </form>

    <!-- Add Cloudinary Account Modal -->
    <div class="modal fade" id="addAccountModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus me-2"></i>
                        <span data-lang="en">Add Cloudinary Account</span>
                        <span data-lang="ar">إضافة حساب Cloudinary</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="cloudinaryAccountForm" onsubmit="event.preventDefault(); addCloudinaryAccount();">
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <span data-lang="en">You can find these credentials in your Cloudinary dashboard under Settings > API Keys.</span>
                            <span data-lang="ar">يمكنك العثور على هذه البيانات في لوحة تحكم Cloudinary تحت الإعدادات > مفاتيح API.</span>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label" for="account_name">
                                <span data-lang="en">Account Name</span>
                                <span data-lang="ar">اسم الحساب</span>
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="account_name" name="account_name" 
                                   required placeholder="Main Account">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label" for="cloud_name">
                                <span data-lang="en">Cloud Name</span>
                                <span data-lang="ar">اسم السحابة</span>
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="cloud_name" name="cloud_name" 
                                   required placeholder="dmxcipnbf">
                            <div class="form-text">
                                <span data-lang="en">Your Cloudinary cloud name</span>
                                <span data-lang="ar">اسم السحابة الخاص بك في Cloudinary</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label" for="api_key">
                                <span data-lang="en">API Key</span>
                                <span data-lang="ar">مفتاح API</span>
                                <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="api_key" name="api_key" 
                                   required placeholder="123456789012345">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label" for="api_secret">
                                <span data-lang="en">API Secret</span>
                                <span data-lang="ar">المفتاح السري</span>
                                <span class="text-danger">*</span>
                            </label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="api_secret" name="api_secret" 
                                       required placeholder="AbCdEfGhIjKlMnOpQrStUvWxYz">
                                <button type="button" class="btn btn-outline-secondary" 
                                        onclick="togglePassword('api_secret')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="storage_limit">
                                    <span data-lang="en">Storage Limit (MB)</span>
                                    <span data-lang="ar">حد التخزين (ميجابايت)</span>
                                </label>
                                <input type="number" class="form-control" id="storage_limit" name="storage_limit" 
                                       value="25600" min="1000" step="100">
                                <div class="form-text">
                                    <span data-lang="en">25,600 MB = 25 GB (free plan)</span>
                                    <span data-lang="ar">25,600 ميجابايت = 25 جيجابايت (الخطة المجانية)</span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label" for="plan_type">
                                    <span data-lang="en">Plan Type</span>
                                    <span data-lang="ar">نوع الخطة</span>
                                </label>
                                <select class="form-select" id="plan_type" name="plan_type">
                                    <option value="free">Free</option>
                                    <option value="paid_plus">Paid Plus</option>
                                    <option value="advanced">Advanced</option>
                                    <option value="enterprise">Enterprise</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="is_primary" name="is_primary">
                                <label class="form-check-label" for="is_primary">
                                    <span data-lang="en">Set as primary account</span>
                                    <span data-lang="ar">تعيين كحساب أساسي</span>
                                </label>
                                <div class="form-text">
                                    <span data-lang="en">Primary account is used first for new uploads</span>
                                    <span data-lang="ar">الحساب الأساسي يُستخدم أولاً للرفع الجديد</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <span data-lang="en">Cancel</span>
                            <span data-lang="ar">إلغاء</span>
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>
                            <span data-lang="en">Add Account</span>
                            <span data-lang="ar">إضافة الحساب</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Danger Zone (Hidden by default) -->
    <div class="danger-zone" id="dangerZone" style="display: none;">
        <h5>
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span data-lang="en">Danger Zone</span>
            <span data-lang="ar">منطقة الخطر</span>
        </h5>
        <p class="text-muted">
            <span data-lang="en">These actions cannot be undone. Please be very careful.</span>
            <span data-lang="ar">هذه الإجراءات لا يمكن التراجع عنها. يرجى الحذر الشديد.</span>
        </p>
        
        <div class="row">
            <div class="col-md-4">
                <form method="POST" onsubmit="return confirm('هل أنت متأكد من إعادة تعيين جميع الإعدادات؟')">
                    <input type="hidden" name="action" value="reset_defaults">
                    <button type="submit" class="btn btn-danger w-100">
                        <i class="fas fa-redo me-1"></i>
                        <span data-lang="en">Reset to Defaults</span>
                        <span data-lang="ar">إعادة تعيين افتراضي</span>
                    </button>
                </form>
            </div>
            <div class="col-md-4">
                <button type="button" class="btn btn-warning w-100" onclick="showImportModal()">
                    <i class="fas fa-upload me-1"></i>
                    <span data-lang="en">Import Settings</span>
                    <span data-lang="ar">استيراد الإعدادات</span>
                </button>
            </div>
            <div class="col-md-4">
                <form method="POST">
                    <input type="hidden" name="action" value="clear_cache">
                    <button type="submit" class="btn btn-secondary w-100">
                        <i class="fas fa-broom me-1"></i>
                        <span data-lang="en">Clear All Cache</span>
                        <span data-lang="ar">مسح جميع الذاكرة</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <span data-lang="en">Import Settings</span>
                    <span data-lang="ar">استيراد الإعدادات</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST">
                <div class="modal-body">
                    <input type="hidden" name="action" value="import_settings">
                    <div class="form-group">
                        <label class="form-label">
                            <span data-lang="en">Settings JSON Data</span>
                            <span data-lang="ar">بيانات JSON للإعدادات</span>
                        </label>
                        <textarea class="form-control" name="import_data" rows="10" 
                                  placeholder='{"site_name": "My Site", "theme_color": "#007bff", ...}'></textarea>
                        <div class="form-text">
                            <span data-lang="en">Paste the exported settings JSON data here</span>
                            <span data-lang="ar">الصق بيانات JSON المصدرة هنا</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <span data-lang="en">Cancel</span>
                        <span data-lang="ar">إلغاء</span>
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <span data-lang="en">Import</span>
                        <span data-lang="ar">استيراد</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function updateColorPreview(input, previewId) {
    const preview = document.getElementById(previewId);
    const textInput = input.nextElementSibling;
    preview.style.backgroundColor = input.value;
    textInput.value = input.value;
}

function updateRangeValue(input, displayId) {
    document.getElementById(displayId).textContent = input.value;
}

function showDangerZone() {
    const dangerZone = document.getElementById('dangerZone');
    dangerZone.style.display = dangerZone.style.display === 'none' ? 'block' : 'none';
}

function showImportModal() {
    new bootstrap.Modal(document.getElementById('importModal')).show();
}

function testEmailSettings() {
    fetch('/admin/settings', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'action=test_email'
    }).then(response => {
        if (response.ok) {
            alert('تم اختبار إعدادات البريد الإلكتروني بنجاح');
        }
    });
}

function clearCache() {
    fetch('/admin/settings', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'action=clear_cache'
    }).then(response => {
        if (response.ok) {
            alert('تم مسح الذاكرة المؤقتة بنجاح');
        }
    });
}

function exportSettings() {
    fetch('/admin/settings', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'action=export_settings'
    }).then(response => response.text())
    .then(data => {
        const blob = new Blob([data], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'manga_platform_settings.json';
        a.click();
        URL.revokeObjectURL(url);
    });
}

function resetForm() {
    if (confirm('هل تريد إعادة تعيين النموذج؟')) {
        document.getElementById('settingsForm').reset();
    }
}

// Logo upload and preview functions
function previewLogo(input) {
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Validate file type
        if (!file.type.startsWith('image/')) {
            alert('يرجى اختيار ملف صورة صحيح');
            input.value = '';
            return;
        }

        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
            alert('حجم الصورة يجب أن يكون أقل من 5 ميجابايت');
            input.value = '';
            return;
        }

        // Upload the logo immediately
        const formData = new FormData();
        formData.append('logo', file);
        
        // Show loading state
        const preview = document.getElementById('logo-preview');
        if (preview) {
            preview.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin fa-2x"></i><p class="mt-2">جاري الرفع...</p></div>';
        }

        fetch('/admin/upload-logo', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update preview
                if (preview) {
                    preview.innerHTML = `<img src="${data.url}" alt="Site Logo" class="logo-preview img-fluid" style="max-height: 80px; max-width: 200px;">`;
                }
                
                // Update hidden field
                const logoUrlField = document.getElementById('logo-url-field');
                if (logoUrlField) {
                    logoUrlField.value = data.url;
                }
                
                // Update URL input
                const logoUrlInput = document.getElementById('logo-url-input');
                if (logoUrlInput) {
                    logoUrlInput.value = data.url;
                }
                
                // Show success message
                alert('تم رفع الشعار بنجاح!');
                
                // Refresh page to update navbar logo
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
            } else {
                alert('حدث خطأ في رفع الشعار: ' + data.message);
                if (preview) {
                    preview.innerHTML = '<div class="logo-preview-placeholder"><i class="fas fa-image fa-2x text-muted"></i><p class="text-muted mt-2">لم يتم رفع شعار</p></div>';
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('حدث خطأ في رفع الشعار');
            if (preview) {
                preview.innerHTML = '<div class="logo-preview-placeholder"><i class="fas fa-image fa-2x text-muted"></i><p class="text-muted mt-2">لم يتم رفع شعار</p></div>';
            }
        });
    }
}

function updateLogoUrl(url) {
    const logoUrlField = document.getElementById('logo-url-field');
    if (logoUrlField) {
        logoUrlField.value = url;
    }
    
    const preview = document.getElementById('logo-preview');
    if (preview) {
        if (url && url.trim()) {
            preview.innerHTML = `<img src="${url}" alt="Site Logo" class="logo-preview img-fluid" style="max-height: 80px; max-width: 200px;" onerror="this.parentElement.innerHTML='<div class=\\'logo-preview-placeholder\\'><i class=\\'fas fa-image fa-2x text-muted\\'></i><p class=\\'text-muted mt-2\\'>رابط الصورة غير صحيح</p></div>'">`;
        } else {
            preview.innerHTML = '<div class="logo-preview-placeholder"><i class="fas fa-image fa-2x text-muted"></i><p class="text-muted mt-2">لم يتم رفع شعار</p></div>';
        }
    }
}

// Form submission handler - wait for DOM to be ready
document.addEventListener('DOMContentLoaded', function() {
    const settingsForm = document.getElementById('settingsForm');
    if (!settingsForm) {
        console.error('Settings form not found!');
        return;
    }
    
    console.log('Settings form found, adding event listener');
    
    settingsForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>جاري الحفظ...';
    submitBtn.disabled = true;
    
    const formData = new FormData(this);
    
    // Debug: Log all form data including ConvertAPI settings
    console.log('Form data being sent:');
    for (let [key, value] of formData.entries()) {
        if (key.includes('convertapi')) {
            console.log(`${key}: ${value}`);
        }
    }
    
    fetch('/admin/settings', {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: formData
    })
    .then(response => {
        console.log('Response status:', response.status);
        if (response.ok) {
            // Try to parse as JSON first, then fallback to text
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                return response.json().then(data => ({type: 'json', data: data}));
            } else {
                return response.text().then(html => ({type: 'html', data: html}));
            }
        }
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    })
    .then(result => {
        console.log('Response received:', result);
        
        let message = 'تم حفظ الإعدادات بنجاح';
        
        if (result.type === 'json' && result.data.message) {
            message = result.data.message;
        }
        
        // Show success message
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show';
        alertDiv.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        const container = document.querySelector('.container-fluid');
        container.insertBefore(alertDiv, container.firstChild);
        
        // Auto-hide alert after 5 seconds
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
        
        // Scroll to top to show the alert
        window.scrollTo({top: 0, behavior: 'smooth'});
    })
    .catch(error => {
        console.error('Error:', error);
        alert('حدث خطأ أثناء حفظ الإعدادات');
    })
    .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
    });
});

// Direct function for onclick handler
function handleSaveSettings(event) {
    event.preventDefault();
    console.log('Save settings button clicked - direct handler');
    
    const form = document.getElementById('settingsForm');
    const submitBtn = event.target;
    
    if (!form) {
        console.error('Settings form not found!');
        alert('لم يتم العثور على نموذج الإعدادات!');
        return;
    }
    
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>جاري الحفظ...';
    submitBtn.disabled = true;
    
    const formData = new FormData(form);
    
    fetch('/admin/settings', {
        method: 'POST',
        headers: {'X-Requested-With': 'XMLHttpRequest'},
        body: formData
    })
    .then(response => {
        console.log('Response status:', response.status);
        if (response.ok) {
            return response.json();
        }
        throw new Error('Network response was not ok');
    })
    .then(data => {
        console.log('Success data:', data);
        
        // Show success message
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show';
        alertDiv.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>${data.message || 'تم حفظ الإعدادات بنجاح'}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        const container = document.querySelector('.container-fluid') || document.body;
        container.insertBefore(alertDiv, container.firstChild);
        
        setTimeout(() => alertDiv.remove(), 5000);
        window.scrollTo({top: 0, behavior: 'smooth'});
    })
    .catch(error => {
        console.error('Error:', error);
        alert('حدث خطأ أثناء حفظ الإعدادات: ' + error.message);
    })
    .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
}

// Backup event listener in case DOMContentLoaded doesn't work
setTimeout(() => {
    const settingsForm = document.getElementById('settingsForm');
    if (settingsForm && !settingsForm.hasAttribute('data-listener-added')) {
        console.log('Adding backup event listener to settings form');
        settingsForm.setAttribute('data-listener-added', 'true');
        
        settingsForm.addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Backup form submit handler triggered');
            
            const submitBtn = this.querySelector('button[type="submit"]');
            if (!submitBtn) {
                console.error('Submit button not found');
                return;
            }
            
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>جاري الحفظ...';
            submitBtn.disabled = true;
            
            const formData = new FormData(this);
            
            // Debug: Log all form data including ConvertAPI settings
            console.log('Backup handler - Form data being sent:');
            for (let [key, value] of formData.entries()) {
                if (key.includes('convertapi')) {
                    console.log(`${key}: ${value}`);
                }
            }
            
            fetch('/admin/settings', {
                method: 'POST',
                headers: {'X-Requested-With': 'XMLHttpRequest'},
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok');
            })
            .then(data => {
                // Show success message
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success alert-dismissible fade show';
                alertDiv.innerHTML = `
                    <i class="fas fa-check-circle me-2"></i>${data.message || 'تم حفظ الإعدادات بنجاح'}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                const container = document.querySelector('.container-fluid') || document.body;
                container.insertBefore(alertDiv, container.firstChild);
                
                setTimeout(() => alertDiv.remove(), 5000);
                window.scrollTo({top: 0, behavior: 'smooth'});
            })
            .catch(error => {
                console.error('Error:', error);
                alert('حدث خطأ أثناء حفظ الإعدادات');
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });
    }
}, 1000);

// Auto-save draft every 5 minutes
setInterval(() => {
    const settingsForm = document.getElementById('settingsForm');
    if (settingsForm) {
        const formData = new FormData(settingsForm);
        formData.set('action', 'save_draft');
        fetch('/admin/settings', {method: 'POST', body: formData});
    }
}, 300000);

// Additional debugging and fallback
window.addEventListener('load', function() {
    console.log('Window loaded, checking settings form...');
    const settingsForm = document.getElementById('settingsForm');
    const saveButton = document.querySelector('button[type="submit"]');
    
    console.log('Settings form:', settingsForm);
    console.log('Save button:', saveButton);
    
    if (saveButton && !saveButton.hasAttribute('onclick')) {
        console.log('Adding fallback click handler to save button');
        saveButton.addEventListener('click', handleSaveSettings);
    }
});

// Global fallback function accessible from console
window.testSaveSettings = function() {
    console.log('Testing save settings manually...');
    handleSaveSettings({
        preventDefault: function() {},
        target: document.querySelector('button[type="submit"]')
    });
};

// Logo upload and preview functions
function previewLogo(input) {
    const file = input.files[0];
    const preview = document.getElementById('logo-preview');
    const urlField = document.getElementById('logo-url-field');
    const urlInput = document.getElementById('logo-url-input');
    
    if (file) {
        // Validate file type
        const validTypes = ['image/jpeg', 'image/png', 'image/svg+xml', 'image/gif'];
        if (!validTypes.includes(file.type)) {
            alert('يُرجى اختيار ملف صورة صالح (PNG, JPG, SVG, GIF)');
            input.value = '';
            return;
        }
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
            alert('حجم الملف يجب أن يكون أقل من 5 ميجابايت');
            input.value = '';
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            // Update preview
            preview.innerHTML = `<img src="${e.target.result}" alt="Site Logo" class="logo-preview">`;
            
            // Upload file and get URL
            uploadLogoFile(file);
        };
        reader.readAsDataURL(file);
        
        // Clear URL input when file is selected
        urlInput.value = '';
    }
}

function uploadLogoFile(file) {
    const formData = new FormData();
    formData.append('logo', file);
    formData.append('action', 'upload_logo');
    
    // Show progress
    const progressDiv = document.createElement('div');
    progressDiv.className = 'upload-progress';
    progressDiv.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>جاري رفع الشعار...';
    progressDiv.style.display = 'block';
    
    const container = document.querySelector('.logo-preview-container');
    container.appendChild(progressDiv);
    
    fetch('/admin/upload-logo', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        progressDiv.remove();
        
        if (data.success) {
            // Update hidden field with new URL
            document.getElementById('logo-url-field').value = data.url;
            document.getElementById('logo-url-input').value = data.url;
            
            // Show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'upload-success';
            successDiv.innerHTML = '<i class="fas fa-check-circle me-2"></i>تم رفع الشعار بنجاح';
            successDiv.style.display = 'block';
            container.appendChild(successDiv);
            
            setTimeout(() => successDiv.remove(), 3000);
        } else {
            // Show error
            const errorDiv = document.createElement('div');
            errorDiv.className = 'upload-error';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle me-2"></i>${data.message || 'فشل في رفع الشعار'}`;
            errorDiv.style.display = 'block';
            container.appendChild(errorDiv);
            
            setTimeout(() => errorDiv.remove(), 5000);
        }
    })
    .catch(error => {
        progressDiv.remove();
        console.error('Upload error:', error);
        alert('حدث خطأ أثناء رفع الشعار');
    });
}

function updateLogoUrl(url) {
    const preview = document.getElementById('logo-preview');
    const urlField = document.getElementById('logo-url-field');
    const fileInput = document.getElementById('logo-upload');
    
    if (url) {
        // Update preview
        preview.innerHTML = `<img src="${url}" alt="Site Logo" class="logo-preview" onerror="showLogoError()">`;
        
        // Update hidden field
        urlField.value = url;
        
        // Clear file input when URL is entered
        fileInput.value = '';
    } else {
        // Show placeholder
        preview.innerHTML = `
            <div class="logo-preview-placeholder">
                <i class="fas fa-image fa-2x text-muted"></i>
                <p class="text-muted mt-2">
                    <span data-lang="en">No logo uploaded</span>
                    <span data-lang="ar">لم يتم رفع شعار</span>
                </p>
            </div>
        `;
        urlField.value = '';
    }
}

function showLogoError() {
    const preview = document.getElementById('logo-preview');
    preview.innerHTML = `
        <div class="logo-preview-placeholder">
            <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
            <p class="text-warning mt-2">
                <span data-lang="en">Failed to load image</span>
                <span data-lang="ar">فشل في تحميل الصورة</span>
            </p>
        </div>
    `;
}


// Toggle password visibility
function togglePassword(inputId) {
    const input = document.getElementById(inputId) || document.querySelector(`input[name="${inputId}"]`);
    const button = input.nextElementSibling;
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Admin credentials form validation
document.addEventListener('DOMContentLoaded', function() {
    const adminForm = document.getElementById('adminCredentialsForm');
    if (adminForm) {
        adminForm.addEventListener('submit', function(e) {
            const newPassword = document.getElementById('new_password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            
            // If new password is provided, confirm password must match
            if (newPassword && newPassword !== confirmPassword) {
                e.preventDefault();
                alert('كلمات المرور الجديدة غير متطابقة');
                return false;
            }
            
            // If new password is provided, it must be at least 8 characters
            if (newPassword && newPassword.length < 8) {
                e.preventDefault();
                alert('كلمة المرور الجديدة يجب أن تكون 8 أحرف على الأقل');
                return false;
            }
            
            // Show confirmation dialog
            if (!confirm('هل أنت متأكد من تحديث بيانات المدير؟ قد تحتاج لتسجيل الدخول مرة أخرى.')) {
                e.preventDefault();
                return false;
            }
        });
        
        // Real-time password matching validation
        const newPasswordInput = document.getElementById('new_password');
        const confirmPasswordInput = document.getElementById('confirm_password');
        
        function validatePasswordMatch() {
            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (newPassword && confirmPassword && newPassword !== confirmPassword) {
                confirmPasswordInput.setCustomValidity('كلمات المرور غير متطابقة');
                confirmPasswordInput.classList.add('is-invalid');
            } else {
                confirmPasswordInput.setCustomValidity('');
                confirmPasswordInput.classList.remove('is-invalid');
            }
        }
        
        newPasswordInput.addEventListener('input', validatePasswordMatch);
        confirmPasswordInput.addEventListener('input', validatePasswordMatch);
    }
});

// Cloudinary account management functions
function addCloudinaryAccount() {
    const form = document.getElementById('cloudinaryAccountForm');
    const formData = new FormData(form);
    
    fetch('/admin/cloudinary/add-account', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.message || 'حدث خطأ في إضافة الحساب');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('حدث خطأ في إضافة الحساب');
    });
}

function deleteCloudinaryAccount(accountId) {
    if (confirm('هل أنت متأكد من حذف هذا الحساب؟ قد يؤثر هذا على الصور المرفوعة مسبقاً.')) {
        fetch(`/admin/cloudinary/delete-account/${accountId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'حدث خطأ في حذف الحساب');
            }
        });
    }
}

function testCloudinaryConnection(accountId) {
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الاختبار...';
    button.disabled = true;
    
    fetch(`/admin/cloudinary/test-connection/${accountId}`)
        .then(response => response.json())
        .then(data => {
            button.innerHTML = originalText;
            button.disabled = false;
            if (data.success) {
                alert('تم الاتصال بنجاح! 🎉');
            } else {
                alert(`فشل الاتصال: ${data.error}`);
            }
        })
        .catch(error => {
            button.innerHTML = originalText;
            button.disabled = false;
            alert('حدث خطأ في اختبار الاتصال');
        });
}

// Bravo Mail functions
function testBravoMailConnection() {
    const testButton = event.target;
    const originalText = testButton.innerHTML;
    testButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الاختبار...';
    testButton.disabled = true;
    
    const testResult = document.getElementById('testEmailResult');
    testResult.style.display = 'none';
    
    fetch('/admin/test-bravo-mail', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('meta[name=csrf-token]').getAttribute('content')
        },
        body: JSON.stringify({
            test_email: document.getElementById('testEmailAddress').value || '{{ current_user.email if current_user.is_authenticated }}'
        })
    })
    .then(response => response.json())
    .then(data => {
        testButton.innerHTML = originalText;
        testButton.disabled = false;
        
        testResult.style.display = 'block';
        if (data.success) {
            testResult.className = 'alert alert-success mt-3';
            testResult.innerHTML = `<i class="fas fa-check-circle"></i> ${data.message}`;
        } else {
            testResult.className = 'alert alert-danger mt-3';
            testResult.innerHTML = `<i class="fas fa-exclamation-circle"></i> خطأ: ${data.error}`;
        }
    })
    .catch(error => {
        testButton.innerHTML = originalText;
        testButton.disabled = false;
        testResult.style.display = 'block';
        testResult.className = 'alert alert-danger mt-3';
        testResult.innerHTML = `<i class="fas fa-times-circle"></i> حدث خطأ في الاختبار: ${error.message}`;
    });
}

function viewEmailTemplates() {
    const modal = new bootstrap.Modal(document.getElementById('emailTemplatesModal'));
    
    // Load templates
    fetch('/admin/bravo-mail/email-templates')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const templatesContainer = document.getElementById('emailTemplatesList');
            templatesContainer.innerHTML = '';
            
            Object.entries(data.templates).forEach(([key, template]) => {
                const templateCard = `
                    <div class="col-md-6 mb-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h6 class="card-title text-primary">${template.name}</h6>
                                <p class="card-text text-muted small">${template.description}</p>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-info" onclick="previewTemplate('${key}')">
                                        <i class="fas fa-eye me-1"></i>معاينة
                                    </button>
                                    <small class="text-muted align-self-center">${template.function}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                templatesContainer.innerHTML += templateCard;
            });
            
            modal.show();
        } else {
            alert('حدث خطأ في جلب القوالب: ' + data.error);
        }
    })
    .catch(error => {
        alert('خطأ في الاتصال مع الخادم');
    });
}

function previewTemplate(templateType) {
    fetch(`/admin/bravo-mail/preview-template/${templateType}`)
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const previewModal = new bootstrap.Modal(document.getElementById('templatePreviewModal'));
            document.getElementById('previewTitle').textContent = `معاينة قالب: ${templateType}`;
            document.getElementById('previewContent').innerHTML = data.preview_html;
            previewModal.show();
        } else {
            alert('حدث خطأ في المعاينة: ' + data.error);
        }
    })
    .catch(error => {
        alert('خطأ في الاتصال مع الخادم');
    });
}

function checkEmailStatus() {
    // Test bulk email functionality
    const modal = new bootstrap.Modal(document.getElementById('bulkTestModal'));
    modal.show();
}

function sendBulkTestEmail() {
    const testMessage = document.getElementById('bulkTestMessage').value || 'رسالة اختبار جماعية من منصة المانجا';
    const recipientsText = document.getElementById('bulkTestRecipients').value;
    
    let recipients = [];
    if (recipientsText.trim()) {
        // Parse recipients from textarea
        recipients = recipientsText.split('\n')
            .filter(line => line.trim())
            .map(line => {
                const parts = line.split(',');
                return {
                    email: parts[0].trim(),
                    name: parts[1] ? parts[1].trim() : parts[0].split('@')[0]
                };
            });
    }
    
    const sendButton = document.getElementById('sendBulkTestBtn');
    const originalText = sendButton.innerHTML;
    sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
    sendButton.disabled = true;
    
    fetch('/admin/bravo-mail/send-bulk-test', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('meta[name=csrf-token]')?.getAttribute('content')
        },
        body: JSON.stringify({
            recipients: recipients,
            message: testMessage
        })
    })
    .then(response => response.json())
    .then(data => {
        const resultDiv = document.getElementById('bulkTestResult');
        resultDiv.className = data.success ? 'alert alert-success' : 'alert alert-danger';
        resultDiv.innerHTML = `
            <i class="fas ${data.success ? 'fa-check-circle' : 'fa-exclamation-circle'} me-2"></i>
            ${data.success ? data.message : data.error}
        `;
        resultDiv.style.display = 'block';
        
        if (data.success && data.sent_count) {
            resultDiv.innerHTML += `<br><small>تم الإرسال إلى ${data.sent_count} مستلم</small>`;
        }
    })
    .catch(error => {
        const resultDiv = document.getElementById('bulkTestResult');
        resultDiv.className = 'alert alert-danger';
        resultDiv.innerHTML = `
            <i class="fas fa-exclamation-circle me-2"></i>
            خطأ في الإرسال الجماعي
        `;
        resultDiv.style.display = 'block';
    })
    .finally(() => {
        sendButton.innerHTML = originalText;
        sendButton.disabled = false;
    });
}

function refreshUsageStats() {
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    fetch('/admin/cloudinary/refresh-usage')
        .then(response => response.json())
        .then(data => {
            button.innerHTML = originalText;
            button.disabled = false;
            if (data.success) {
                location.reload();
            } else {
                alert(data.message || 'فشل في تحديث الإحصائيات');
            }
        });
}

// Update account usage from Cloudinary API
function updateAccountUsage(accountId) {
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    fetch(`/admin/cloudinary/update-usage/${accountId}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        button.innerHTML = originalText;
        button.disabled = false;
        
        if (data.success) {
            // Update the UI with new data
            const usage = data.usage_data;
            
            // Update percentage
            document.getElementById(`usage-percentage-${accountId}`).textContent = `${usage.usage_percentage.toFixed(1)}%`;
            
            // Update storage amounts
            document.getElementById(`used-storage-${accountId}`).textContent = `${usage.storage_used_mb.toFixed(1)} MB`;
            document.getElementById(`total-storage-${accountId}`).textContent = `${usage.storage_limit_mb.toFixed(1)} MB`;
            
            // Update progress bar
            const progressBar = document.getElementById(`progress-bar-${accountId}`);
            progressBar.style.width = `${usage.usage_percentage}%`;
            
            // Update progress bar color
            if (usage.usage_percentage > 90) {
                progressBar.className = 'progress-bar bg-danger';
            } else if (usage.usage_percentage > 75) {
                progressBar.className = 'progress-bar bg-warning';
            } else {
                progressBar.className = 'progress-bar bg-success';
            }
            
            // Update status badge
            const statusBadge = document.getElementById(`status-badge-${accountId}`);
            if (usage.usage_percentage < 95) {
                statusBadge.className = 'badge bg-success';
                statusBadge.innerHTML = '<span data-lang="en">Available</span><span data-lang="ar">متاح</span>';
            } else {
                statusBadge.className = 'badge bg-danger';
                statusBadge.innerHTML = '<span data-lang="en">Full</span><span data-lang="ar">ممتلئ</span>';
            }
            
            // Show real-time usage info
            const realUsageInfo = document.getElementById(`real-usage-info-${accountId}`);
            realUsageInfo.style.display = 'block';
            
            // Update media count and credits
            document.getElementById(`media-count-${accountId}`).textContent = usage.media_count || '-';
            document.getElementById(`credits-usage-${accountId}`).textContent = `${(usage.credits_percentage || 0).toFixed(1)}%`;
            
            // Show success message
            showAlert('success', 'تم تحديث بيانات الاستخدام من Cloudinary بنجاح!', 'Usage data updated successfully from Cloudinary!');
        } else {
            showAlert('danger', `فشل التحديث: ${data.error}`, `Update failed: ${data.error}`);
        }
    })
    .catch(error => {
        button.innerHTML = originalText;
        button.disabled = false;
        console.error('Error:', error);
        showAlert('danger', 'حدث خطأ في تحديث بيانات الاستخدام', 'Error updating usage data');
    });
}

// Switch to different Cloudinary account
function switchToAccount(accountId) {
    if (confirm('هل أنت متأكد من التبديل إلى هذا الحساب كحساب أساسي؟')) {
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التبديل...';
        button.disabled = true;
        
        fetch(`/admin/cloudinary/switch-account/${accountId}`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showAlert('success', `تم التبديل إلى حساب ${data.account_name} بنجاح!`, `Successfully switched to ${data.account_name}!`);
                // Reload page to reflect changes
                setTimeout(() => location.reload(), 1500);
            } else {
                button.innerHTML = originalText;
                button.disabled = false;
                showAlert('danger', `فشل التبديل: ${data.error}`, `Switch failed: ${data.error}`);
            }
        })
        .catch(error => {
            button.innerHTML = originalText;
            button.disabled = false;
            console.error('Error:', error);
            showAlert('danger', 'حدث خطأ في التبديل بين الحسابات', 'Error switching accounts');
        });
    }
}

// Get real-time usage for all accounts
function refreshAllAccountsUsage() {
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري التحديث...';
    button.disabled = true;
    
    fetch('/admin/cloudinary/real-usage')
    .then(response => response.json())
    .then(data => {
        button.innerHTML = originalText;
        button.disabled = false;
        
        if (data.success) {
            // Update each account with real usage data
            data.accounts.forEach(account => {
                if (account.success) {
                    // Find and update the account
                    const accountId = account.account_id;
                    
                    // Update UI elements if they exist
                    const usageElement = document.getElementById(`usage-percentage-${accountId}`);
                    if (usageElement) {
                        usageElement.textContent = `${account.usage_percentage.toFixed(1)}%`;
                    }
                    
                    const usedElement = document.getElementById(`used-storage-${accountId}`);
                    if (usedElement) {
                        usedElement.textContent = `${account.storage_used_mb.toFixed(1)} MB`;
                    }
                    
                    const totalElement = document.getElementById(`total-storage-${accountId}`);
                    if (totalElement) {
                        totalElement.textContent = `${account.storage_limit_mb.toFixed(1)} MB`;
                    }
                    
                    // Update progress bar
                    const progressBar = document.getElementById(`progress-bar-${accountId}`);
                    if (progressBar) {
                        progressBar.style.width = `${account.usage_percentage}%`;
                        
                        if (account.usage_percentage > 90) {
                            progressBar.className = 'progress-bar bg-danger';
                        } else if (account.usage_percentage > 75) {
                            progressBar.className = 'progress-bar bg-warning';
                        } else {
                            progressBar.className = 'progress-bar bg-success';
                        }
                    }
                }
            });
            
            showAlert('success', 'تم تحديث جميع الحسابات بنجاح!', 'All accounts updated successfully!');
        } else {
            showAlert('danger', `فشل التحديث: ${data.error}`, `Update failed: ${data.error}`);
        }
    })
    .catch(error => {
        button.innerHTML = originalText;
        button.disabled = false;
        console.error('Error:', error);
        showAlert('danger', 'حدث خطأ في تحديث الحسابات', 'Error updating accounts');
    });
}

// Helper function to show alerts
function showAlert(type, arabicMessage, englishMessage) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    alertDiv.style.top = '20px';
    alertDiv.style.right = '20px';
    alertDiv.style.zIndex = '9999';
    alertDiv.style.minWidth = '300px';
    
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : 'exclamation-triangle'} me-2"></i>
        <span data-lang="en">${englishMessage}</span>
        <span data-lang="ar">${arabicMessage}</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.parentNode.removeChild(alertDiv);
        }
    }, 5000);
}

// Update individual setting function for authentication settings
function updateSetting(settingKey, settingValue) {
    // Show loading indicator
    const loadingMessage = document.createElement('div');
    loadingMessage.className = 'alert alert-info alert-dismissible fade show position-fixed';
    loadingMessage.style.top = '20px';
    loadingMessage.style.right = '20px';
    loadingMessage.style.zIndex = '9999';
    loadingMessage.innerHTML = `
        <i class="fas fa-spinner fa-spin me-2"></i>
        <span data-lang="en">Saving setting...</span>
        <span data-lang="ar">جاري حفظ الإعداد...</span>
    `;
    document.body.appendChild(loadingMessage);
    
    // Prepare form data
    const formData = new FormData();
    formData.append('action', 'update_individual_setting');
    formData.append('setting_key', settingKey);
    formData.append('setting_value', settingValue);
    
    // Send AJAX request
    fetch('/admin/settings', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        // Remove loading message
        document.body.removeChild(loadingMessage);
        
        // Show success/error message
        const alertType = data.success ? 'success' : 'danger';
        const alertMessage = document.createElement('div');
        alertMessage.className = `alert alert-${alertType} alert-dismissible fade show position-fixed`;
        alertMessage.style.top = '20px';
        alertMessage.style.right = '20px';
        alertMessage.style.zIndex = '9999';
        
        if (data.success) {
            alertMessage.innerHTML = `
                <i class="fas fa-check me-2"></i>
                <span data-lang="en">Setting saved successfully!</span>
                <span data-lang="ar">تم حفظ الإعداد بنجاح!</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
        } else {
            alertMessage.innerHTML = `
                <i class="fas fa-exclamation-triangle me-2"></i>
                <span data-lang="en">Error saving setting: ${data.message || 'Unknown error'}</span>
                <span data-lang="ar">خطأ في حفظ الإعداد: ${data.message || 'خطأ غير معروف'}</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
        }
        
        document.body.appendChild(alertMessage);
        
        // Auto remove alert after 3 seconds
        setTimeout(() => {
            if (alertMessage.parentNode) {
                alertMessage.parentNode.removeChild(alertMessage);
            }
        }, 3000);
    })
    .catch(error => {
        // Remove loading message
        if (loadingMessage.parentNode) {
            document.body.removeChild(loadingMessage);
        }
        
        console.error('Error:', error);
        
        // Show error message
        const alertMessage = document.createElement('div');
        alertMessage.className = 'alert alert-danger alert-dismissible fade show position-fixed';
        alertMessage.style.top = '20px';
        alertMessage.style.right = '20px';
        alertMessage.style.zIndex = '9999';
        alertMessage.innerHTML = `
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span data-lang="en">Network error occurred</span>
            <span data-lang="ar">حدث خطأ في الشبكة</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(alertMessage);
        
        // Auto remove alert after 3 seconds
        setTimeout(() => {
            if (alertMessage.parentNode) {
                alertMessage.parentNode.removeChild(alertMessage);
            }
        }, 3000);
    });
}
</script>

<!-- Email Templates Modal -->
<div class="modal fade" id="emailTemplatesModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-envelope me-2"></i>
                    قوالب الإيميل المتاحة
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row" id="emailTemplatesList">
                    <!-- Templates will be loaded here dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

<!-- Template Preview Modal -->
<div class="modal fade" id="templatePreviewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="previewTitle">معاينة القالب</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="previewContent">
                    <!-- Template preview will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Test Email Modal -->
<div class="modal fade" id="bulkTestModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-envelope-bulk me-2"></i>
                    اختبار الإرسال الجماعي
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    اختبر وظيفة الإرسال الجماعي لـ Bravo Mail. إذا تُرك حقل المستلمين فارغاً، سيتم الإرسال لجميع المديرين.
                </div>
                
                <div class="mb-3">
                    <label for="bulkTestMessage" class="form-label">رسالة الاختبار</label>
                    <textarea class="form-control" id="bulkTestMessage" rows="3" 
                              placeholder="اكتب رسالة الاختبار هنا...">رسالة اختبار جماعية من منصة المانجا. هذه رسالة تجريبية لاختبار وظيفة الإرسال الجماعي.</textarea>
                </div>
                
                <div class="mb-3">
                    <label for="bulkTestRecipients" class="form-label">المستلمون (اختياري)</label>
                    <textarea class="form-control" id="bulkTestRecipients" rows="4" 
                              placeholder="example1@domain.com,الاسم الأول&#10;example2@domain.com,الاسم الثاني&#10;&#10;كل سطر = إيميل واحد (إيميل,اسم)"></textarea>
                    <div class="form-text">
                        اكتب كل مستلم في سطر منفصل. التنسيق: إيميل,الاسم (الاسم اختياري)
                    </div>
                </div>
                
                <div id="bulkTestResult" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                <button type="button" class="btn btn-primary" id="sendBulkTestBtn" onclick="sendBulkTestEmail()">
                    <i class="fas fa-paper-plane me-1"></i>
                    إرسال الاختبار الجماعي
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}